<!DOCTYPE html>
<html lang="cn">
    <head>
    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="generator" content="Hugo 0.80.0" />

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/remixicon/remixicon.css"><link rel="stylesheet" href="/css/tony.min.2cd909c3b2b4f0eb1f6b8dbe02a8be4ed8a7456895a39f284818ed1e771073c6.css" integrity="sha256-LNkJw7K08Osfa42+Aqi+TtinRWiVo58oSBjtHncQc8Y="/>

    <link rel="shortcut icon" href="/images/t.jpg" type="image/x-icon" />
    <title>线段树</title>

    <meta name="author" content="GBwater" /><meta name="description" content="" />

    
    <link rel="canonical" href="https://gbwater.ga/posts/%E7%BA%BF%E6%AE%B5%E6%A0%91/" />
    
<script>
  MathJax = {
    tex: {
      inlineMath: [["$", "$"]],
    },
    displayMath: [
      ["$$", "$$"],
      ["\[\[", "\]\]"],
    ],
    svg: {
      fontCache: "global",
    },
  };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
></script>



</head>

    <header id="header-div" class="tony-header-fixed">

    <div class="header-div1">
        <a href="https://gbwater.ga/" style="display:inline-block;">
            <img src="/images/t.jpg">
        </a>
    </div>
    <div class="header-div2">
    <a href="/"><button class="btn btn-light">主页</button></a>
    <a href="/tags/"><button class="btn btn-light">标签</button></a>
    <a href="/categories/"><button class="btn btn-light">分类</button></a>
    <a href="/archives/"><button class="btn btn-light">归档</button></a>
    <a href="/about/"><button class="btn btn-light">关于</button></a>
    <a href="/links/"><button class="btn btn-light">友链</button></a>
    
</div>
</header>
    <body>
        
    <div id="post-container">
    <div class="grid grid-centered">
        <div id="grid-cell" class="grid-cell">
            
                <div class="single-left">
                    
        
        
        
        
            
            
            
            <div class="index-div">
                <div class="single-index">
                    <h4>
                        <i class="ri-list-check-2"></i>
                        
                    </h4>
                </div>  
                <ul id="article-index" class="index-ul">
                    
                        
                        
                            
                                
                                
                                <a href="#%e7%ae%80%e4%bb%8b">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;简介
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;工作原理
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%9f%ba%e7%a1%80">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;基础
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%9f%a5%e8%af%a2">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;查询
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e8%a7%82%e5%af%9f%e8%bf%99%e6%a3%b5%e6%a0%91%e5%8f%af%e4%bb%a5%e5%8f%91%e7%8e%b0%e6%9c%89%e8%bf%99%e4%b8%a4%e4%b8%aa%e7%89%b9%e7%82%b9">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;观察这棵树，可以发现有这两个特点
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%9f%a5%e8%af%a2%e6%96%b9%e6%b3%95">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;查询方法
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%a8%a1%e6%8b%9f%e4%b8%80%e4%b8%8b%e6%9f%a5%e8%af%a2%e7%9a%84%e8%bf%87%e7%a8%8b%e6%9f%a5%e8%af%a2%e5%8c%ba%e9%97%b4-24-%e7%9a%84%e6%9c%80%e5%a4%a7%e5%80%bc">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;模拟一下查询的过程(查询区间 [2,4] 的最大值)
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%8f%af%e4%bb%a5%e7%94%b1%e6%ad%a4%e5%86%99%e5%87%ba%e6%9f%a5%e8%af%a2%e4%bb%a3%e7%a0%81%e6%9c%80%e5%a4%a7%e5%80%bc">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;可以由此写出查询代码(最大值)
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e4%bf%ae%e6%94%b9">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;修改
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%8d%95%e7%82%b9%e4%bf%ae%e6%94%b9">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;单点修改
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e4%bf%ae%e6%94%b9%e6%96%b9%e6%b3%95">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;修改方法
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%a8%a1%e6%8b%9f%e4%b8%80%e4%b8%8b%e5%8d%95%e7%82%b9%e4%bf%ae%e6%94%b9%e7%9a%84%e8%bf%87%e7%a8%8b%e5%b0%8611%e8%bf%99%e4%b8%aa%e6%95%b0%e4%bf%ae%e6%94%b9%e4%b8%ba9">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;模拟一下单点修改的过程(将[1,1]这个数修改为9)
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e7%94%b1%e6%ad%a4%e5%8f%af%e4%bb%a5%e5%86%99%e5%87%ba%e5%8d%95%e7%82%b9%e4%bf%ae%e6%94%b9%e4%bb%a3%e7%a0%81%e6%9c%80%e5%a4%a7%e5%80%bc">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;由此可以写出单点修改代码(最大值)
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%8c%ba%e9%97%b4%e4%bf%ae%e6%94%b9">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;区间修改
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%80%9d%e8%b7%af">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;思路
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e4%bf%ae%e6%94%b9%e6%96%b9%e6%b3%95-1">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;修改方法
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%90%8e%e7%bb%ad%e6%9f%a5%e8%af%a2%e6%96%b9%e6%b3%95">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;后续查询方法
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%a8%a1%e6%8b%9f%e4%b8%80%e4%b8%8b%e4%bf%ae%e6%94%b9%e7%9a%84%e8%bf%87%e7%a8%8b%e5%b0%8603%e5%8c%ba%e9%97%b4%e7%9a%84%e6%95%b0%e5%85%a8%e9%83%a81">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;模拟一下修改的过程(将[0,3]区间的数全部&#43;1)
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%86%8d%e6%a8%a1%e6%8b%9f%e4%b8%80%e4%b8%8b%e6%9f%a5%e8%af%a2%e7%9a%84%e8%bf%87%e7%a8%8b%e6%9f%a5%e8%af%a223%e7%9a%84%e6%9c%80%e5%a4%a7%e5%80%bc">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;再模拟一下查询的过程(查询[2,3]的最大值)
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e7%94%b1%e6%ad%a4%e5%8f%af%e4%bb%a5%e5%86%99%e5%87%ba%e4%bf%ae%e6%94%b9%e4%bb%a3%e7%a0%81">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;由此可以写出修改代码
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%9e%84%e5%bb%ba%e7%ba%bf%e6%ae%b5%e6%a0%91">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;构建线段树
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e8%bf%9b%e9%98%b6">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;进阶
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%8c%ba%e9%97%b4%e5%92%8c">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;区间和
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%96%b9%e6%b3%95">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;方法
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%9f%a5%e8%af%a2%e5%8c%ba%e9%97%b4%e5%92%8c%e4%bb%a3%e7%a0%81">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;查询区间和代码
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%9b%b4%e6%96%b0%e4%bb%a3%e7%a0%81">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;更新代码
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%8c%ba%e9%97%b4%e4%b9%98%e6%b3%95">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;区间乘法
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%96%b9%e6%b3%95-1">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;方法
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e4%bc%a0%e9%80%92%e6%a0%87%e8%ae%b0%e4%bb%a3%e7%a0%81">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;传递标记代码
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%8c%ba%e9%97%b4%e4%b9%98%e6%b3%95%e4%bb%a3%e7%a0%81">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;区间乘法代码
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%ae%8c%e6%95%b4%e4%bb%a3%e7%a0%81">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;完整代码
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%8c%87%e9%92%88%e7%89%88%e7%90%86%e8%a7%a3%e4%b8%8b%e8%92%9f%e8%92%bb%e7%9a%84%e6%80%9d%e8%b7%af">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;指针版(理解下蒟蒻的思路)
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e6%95%b0%e7%bb%84%e7%89%88%e7%9f%a5%e9%81%93%e8%83%bd%e6%8b%bf%e6%95%b0%e7%bb%84%e5%86%99%e5%b0%b1%e5%a5%bd">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;数组版(知道能拿数组写就好)
                                    </li>
                                </a>
                            
                        
                    
                        
                        
                            
                                
                                
                                <a href="#%e5%8e%8b%e8%a1%8c%e7%89%88%e6%9c%80%e5%a5%bd%e5%a4%9a%e6%89%93%e5%87%a0%e9%81%8d%e8%83%8c%e4%b8%8b%e6%9d%a5">
                                    <li style="padding-left:23px" class="">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        &nbsp;&nbsp;压行版(最好多打几遍背下来)
                                    </li>
                                </a>
                            
                        
                    
                </ul>
            </div>
        
                    




    
        <div>
            <div class="index-div-prev">
                <h4></h4>
                <p>
                    <a href="/posts/%E4%B8%BB%E5%B8%AD%E6%A0%91/" rel="next">主席树</a>
                </p>
            </div>
        </div>
    
    
        <div>
            <div class="index-div-next">
                <h4></h4>
                <p>
                    <a href="/posts/%E5%AE%9A%E6%97%B6%E5%85%B3%E6%9C%BA/" rel="prev">定时关机</a>
                </p>
            </div>
        </div>
    

                </div>
            
            
                <div id="reading-bar"></div>
            
            <article class="article reveal">
                <div id="load">
                    <div class="article-header">
                        
    
        <span class="badge badge-pill badge-danger single-badge">
            <a href="https://gbwater.ga/categories/oi" class="post-header">OI</a>
        </span>
    

<span title="预计阅读时长" class="badge badge-pill badge-danger single-badge post-header">
    24 mins
</span>
<h2 class="single-h2">线段树</h2>
<div class="article-list-footer">
    <span class="article-list-date">26-04-20</span>
    <span class="article-list-divider">/</span>
    <span class="article-list-minutes">11953 Words</span>
</div>
<div class="single-line"></div>
                    </div>
                    <div class="article-content">
                        <h1 id="简介">简介</h1>
<p>对于RMQ问题，暴力计算时间复杂度踏大了，所以要预处理<br>
预处理全部子区间空间复杂度踏大了，预处理的时间复杂度踏大了，还贼难修改<br>
如果能预处理一部分子区间，正好对上查询区间最好，对不上也能用预处理过的区间“拼凑”出查询区间，时间空间复杂度还小就完美了<br>
区间怎么选呢？当然是二分啦 <del>多么优秀的想法</del></p>
<p>线段树是一种数据结构，用来解决RMQ(区间最值)问题 <del>当然拓展一下也可以有别的用法</del><br>
顾名思义，线段树是一棵二叉树 ，所谓线段，特别之处是线段树上的每个结点代表一个区间<br>
其查询和修改的时间复杂度为Olog(n)</p>
<h2 id="工作原理">工作原理</h2>
<p>对于一棵线段树来说，每个节点有两个子节点，每个节点的区间长度都是其父节点的一半，并提前预处理好了每个节点代表区间的待查询数据。这样在查询和修改时，就可以分为三类：</p>
<ol>
<li>在区间的左半边</li>
<li>在区间的右半边</li>
<li>在左半边和右半边都有分布</li>
</ol>
<p>这样在查询和修改时就可以按这三种情况进行操作，直到找到的区间</p>
<ol>
<li>在<br>
就像在欧亚大陆上找一个地方，可以分为三种情况：</li>
<li>全部在欧洲，如英国</li>
<li>全部在亚洲，如中国</li>
<li>横跨欧亚大陆，如俄罗斯</li>
</ol>
<p>这样在查询的时候，每次将查询的区间缩小一半，复杂度就达到了$log(n)$级别</p>
<h1 id="基础">基础</h1>
<h2 id="查询">查询</h2>
<p>比如有一段序列：<strong>1 , 3 , 5 , 2 ，2</strong><br>
建立的线段树(每个结点保存其区间的<strong>最大值</strong>)如下 <del>暂且先不管它是怎么建立的</del><br>
<img src="https://s1.ax1x.com/2020/04/26/J6j7rt.png" alt=""></p>
<h4 id="观察这棵树可以发现有这两个特点">观察这棵树，可以发现有这两个特点</h4>
<ul>
<li><strong><font color=green>叶结点</font></strong> 区间长度为1，代表这段序列中的一个个数字</li>
<li><strong><font color=blue>其它结点</font></strong> 的的区间是其两个子节点区间的并集</li>
</ul>
<h4 id="查询方法">查询方法</h4>
<ul>
<li>待查询区间位于左子节点，向左子节点递归查询，并返回结果</li>
<li>待查询区间位于右子节点，向右子节点递归查询，并返回结果</li>
<li>待查询区间分布于两个子节点，拆分区间使其包含于被两个子节点的区间，向两个子节点递归查询，比较，并返回结果</li>
</ul>
<h4 id="模拟一下查询的过程查询区间-24-的最大值">模拟一下查询的过程(查询区间 <strong>[2,4]</strong> 的最大值)</h4>
<ol>
<li>访问根节点，其区间为[0,4]，不是待查询区间，且待查询区间分布于其两个子节点</li>
<li>将待查询区间分为[2,2]和[3,4]向左子节点查询[2,2]</li>
<li>左子节点:其区间为[0,2]，不是待查询区间，待查询区间位于其右子节点</li>
<li>访问左子节点的右子节点，其区间为[2,2]，是待查询区间，返回结果：5</li>
<li>左子节点返回结果：5</li>
<li>向右子节点查询区间[3,4]</li>
<li>右子节点:其区间为[3,4]，是待查询区间，返回结果：2</li>
<li>比较两子节点返回值：5&gt;2，查返回询结果：5</li>
</ol>
<h4 id="可以由此写出查询代码最大值">可以由此写出查询代码(最大值)</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">double</span> <span style="color:#75af00">finda</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树.查询左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span><span style="color:#75715e">//从中间切开,递归分别查询,返回最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="修改">修改</h2>
<h3 id="单点修改">单点修改</h3>
<p>顾名思义，单点修改就是修改序列中的一个数<br>
还是这段序列和这棵线段树<br>
<img src="https://s1.ax1x.com/2020/04/26/J6j7rt.png" alt=""></p>
<h4 id="修改方法">修改方法</h4>
<ol>
<li>找到待修改的叶结点</li>
<li>修改叶结点的值</li>
<li>更新其父节点的值</li>
</ol>
<h4 id="模拟一下单点修改的过程将11这个数修改为9">模拟一下单点修改的过程(将[1,1]这个数修改为9)</h4>
<ol>
<li>访问根节点，待修改节点位于其左子树</li>
<li>访问其左子节点，待修改节点位于其左子树</li>
<li>访问其左子节点，待修改节点是其右子节点</li>
<li>访问其右子节点，修改其值为9</li>
<li>返回其父节点，9&gt;1，更新其值为9</li>
<li>返回其父节点，9&gt;5，更新其值为9</li>
<li>返回其父节点，9&gt;2，更新其值为9</li>
<li>到达根节点，修改结束</li>
</ol>
<h4 id="由此可以写出单点修改代码最大值">由此可以写出单点修改代码(最大值)</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">change</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">v</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">if</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#f92672">==</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#f92672">==</span><span style="color:#111">s</span><span style="color:#111">)</span> <span style="color:#75715e">//找到待修改节点，修改
</span><span style="color:#75715e"></span>    <span style="color:#111">{</span>
        <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">v</span><span style="color:#f92672">=</span><span style="color:#111">v</span><span style="color:#111">;</span>
        <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">s</span><span style="color:#111">)</span> 
    <span style="color:#111">{</span>
        <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">v</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树.查询左子树
</span><span style="color:#75715e"></span>        <span style="color:#111">update</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新该节点的值
</span><span style="color:#75715e"></span>        <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">s</span><span style="color:#111">)</span> 
    <span style="color:#111">{</span>
        <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">v</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>        <span style="color:#111">update</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新该节点的值
</span><span style="color:#75715e"></span>        <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="区间修改">区间修改</h3>
<p>顾名思义，区间修改就是对指定的区间进行 + - * / 操作</p>
<h4 id="思路">思路</h4>
<p>一种想法是对区间中的每个数进行单点修改操作，然而这样做复杂度是Onlog(n)，太大，不可取<br>
上文提到线段树的区间修改可以做到Olog(n)的复杂度，这是怎么实现的呢？<br>
回顾简单思路的问题：不难发现，这样把线段树全部相关节点都修改了，然而有些节点可能不会被使用到<br>
举个栗子：如果按照这种思路将[0,4]全部+1,而后查询区间却没有包含[0,2]，那么[0,2]这个子树就等于白修改了<br>
不难想到解决方法：标记相关子树的根结点，表示这棵子树上的全部结点的值都被修改，使用时再把标记传递给子节点就好了</p>
<h4 id="修改方法-1">修改方法</h4>
<ul>
<li>待查询区间就是此区间，打上标记，返回</li>
<li>待查询区间位于左子节点，向左子节点递归修改，更新</li>
<li>待查询区间位于右子节点，向右子节点递归修改，更新</li>
<li>待查询区间分布于两个子节点，拆分区间使其包含于被两个子节点的区间，向两个子节点递归修改，更新</li>
</ul>
<h4 id="后续查询方法">后续查询方法</h4>
<ul>
<li>待查询区间位于左子节点，把标记传递给左子节点并向其递归查询，并返回结果</li>
<li>待查询区间位于右子节点，把标记传递给右子节点并向其递归查询，并返回结果</li>
<li>待查询区间分布于两个子节点，拆分区间使其包含于被两个子节点的区间，把标记传递给两个子节点并向其递归查询，比较，并返回结果</li>
</ul>
<h4 id="模拟一下修改的过程将03区间的数全部1">模拟一下修改的过程(将[0,3]区间的数全部+1)</h4>
<p><img src="https://s1.ax1x.com/2020/04/26/J6j7rt.png" alt=""></p>
<ol>
<li>访问根节点，不是待修改区间，拆分待修改区间为[0,2]和[3,3]</li>
<li>向左子树查询，是待修改区间，修改标记为1，更新值为6，返回
<img src="https://s1.ax1x.com/2020/04/26/JcZtqU.png" alt=""></li>
<li>向右子树查询，不是待修改区间，待修改区间位于其左子树</li>
<li>向其左子树查询，是待修改区间，且是叶结点，直接修改，返回
<img src="https://s1.ax1x.com/2020/04/26/JcZRde.png" alt=""></li>
<li>3&gt;2，更新值为3，返回
<img src="https://s1.ax1x.com/2020/04/26/Jceuy6.png" alt=""></li>
<li>6&gt;3，更新值为6，结束
<img src="https://s1.ax1x.com/2020/04/26/Jce00S.png" alt=""></li>
</ol>
<h4 id="再模拟一下查询的过程查询23的最大值">再模拟一下查询的过程(查询[2,3]的最大值)</h4>
<ol>
<li>访问根节点，不是待查询区间，拆分其为[2,2]和[3,3]</li>
<li>向左子树查询，不是待查询区间，进一步查询前把标记传递给两个子节点并更新它们的值
<img src="https://s1.ax1x.com/2020/04/26/JcmP1I.png" alt=""></li>
<li>待查询区间位于其右子树，向右子树查询</li>
<li>待查询区间是此区间，返回结果：6</li>
<li>返回结果：6</li>
<li>向右子树查询(此处省略查询步骤)，返回结果：3</li>
<li>6&gt;3，返回查询结果：6</li>
</ol>
<h4 id="由此可以写出修改代码">由此可以写出修改代码</h4>
<p>更新</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">);</span><span style="color:#75715e">//更新最大值
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>传递标记</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span><span style="color:#75715e">//若没有标记,传递啥?
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子结点,无需修改其标记(根本就没标记...)
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">else</span><span style="color:#75715e">//否则,先修改标记,再修改值
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//同上(本来就是复制下来的...)
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">else</span>
	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//删除加法标记
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>区间加法</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">_add</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间完全重合
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//若不是叶子结点,更新加法标记
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间最小值
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间最大值
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若区间完全位于其左子树,向左子树查找区间l~r并执行加法
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">else</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若区间完全位于其右子树,向右子树查找区间l~r并执行加法
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span><span style="color:#75715e">//从中间切开,分别执行加法
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
			<span style="color:#111">}</span>
	<span style="color:#111">}</span>
	<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>查询最大值</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">double</span> <span style="color:#75af00">finda</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树.查询左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span><span style="color:#75715e">//从中间切开,分别查询,返回最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="构建线段树">构建线段树</h3>
<p>其实跟建立普通二叉树一样，只不过多了初始化区间和值以及更新的操作，递归建树即可</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#75af00">_build</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">t</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">node</span><span style="color:#111">;</span><span style="color:#75715e">//建立新节点
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#111">l</span><span style="color:#111">;</span><span style="color:#75715e">//区间左端点
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">;</span><span style="color:#75715e">//区右端点
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">father</span> <span style="color:#f92672">=</span> <span style="color:#111">t</span><span style="color:#111">;</span><span style="color:#75715e">//建立父子关系
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">==</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//若t没有左子树,说明要构建的树为其左子树
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">else</span> <span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//反之,则为右子树
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子节点
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span><span style="color:#75715e">//三个一样
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//返回节点地址
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">=</span><span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">);</span><span style="color:#75715e">//构造左子树
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">=</span><span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//构造右子树
</span><span style="color:#75715e"></span>	<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="进阶">进阶</h1>
<h3 id="区间和">区间和</h3>
<p>线段树除了可以维护最值，还可以维护区间和</p>
<h4 id="方法">方法</h4>
<p>其实也很简单，每一个结点的值就是其子节点的值之和，单点修改只需减掉原来的在加上修改后的就行了，区间加法只需加上<strong>加数×区间长度</strong>即可</p>
<h4 id="查询区间和代码">查询区间和代码</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">double</span> <span style="color:#75af00">findu</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回区间和
</span><span style="color:#75715e"></span>	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//若待查询区间位于其左子树,查询左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//若待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//从中间切开,分别查询,返回和
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="更新代码">更新代码</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">);</span><span style="color:#75715e">//更新最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">);</span><span style="color:#75715e">//更新最小值
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="区间乘法">区间乘法</h3>
<p>线段树除了可以进行区间加法，还可以进行区间乘法</p>
<h4 id="方法-1">方法</h4>
<ul>
<li>进行区间乘法时，最大值，最小值 都只需乘上乘数即可，然后再修改乘法标记。</li>
<li>此处注意，传递标记时要在修改子节点乘法标记的同时将加法标记乘以乘数，然后加上父节点的加法标记，即<strong>先乘后加</strong>原则</li>
</ul>
<h4 id="传递标记代码">传递标记代码</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span><span style="color:#75715e">//若没有标记,传递啥?
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子结点,无需修改其标记(根本就没标记...)
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//先乘后加
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">else</span><span style="color:#75715e">//否则,先修改标记,再修改值
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//先乘后加
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span><span style="color:#75715e">//区间和增加传递的标记乘以区间节点个数
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//同上(本来就是复制下来的...)
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">else</span>
	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//删除加法标记
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span><span style="color:#75715e">//删除乘法标记
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="区间乘法代码">区间乘法代码</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">_multiply</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间完全重合
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//若不是叶子结点,更新乘法标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">k</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span><span style="color:#75715e">//若乘数为正
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最大的还是最大的
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最小的还是最小的
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">double</span> <span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">;</span><span style="color:#75715e">//暂时储存
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最大的符号相反后变成最小的
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最小的符号相反后变为最大的
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新加法标记(下面每个数要加的数也乘了k)
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子节点前先更新标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若待操作区间完全位于左子树,向左子树查询并进行区间乘法
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">else</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若待操作区间完全位于右子树,向右子树查询并进行区间乘法
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span><span style="color:#75715e">//从中间切开,分别进行操作
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
			<span style="color:#111">}</span>
	<span style="color:#111">}</span>
	<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="完整代码">完整代码</h1>
<h2 id="指针版理解下蒟蒻的思路">指针版(理解下蒟蒻的思路)</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">288
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">289
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">290
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">291
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">292
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">293
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">294
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">295
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">296
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">297
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">298
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">299
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">300
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">301
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">302
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">303
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">304
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">305
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">306
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">307
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">308
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">309
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">310
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">311
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">312
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">313
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">314
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">315
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">316
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">317
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">318
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">319
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">320
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">321
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">322
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">323
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">324
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">325
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">326
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">327
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">328
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">329
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">330
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">331
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">332
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">333
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">334
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">335
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">336
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">337
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">338
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">339
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">340
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">341
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">342
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">343
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">344
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">345
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">346
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">347
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">348
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">349
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">350
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">351
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">352
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">353
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">354
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;algorithm&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#00a8c8">using</span> <span style="color:#00a8c8">namespace</span> <span style="color:#111">std</span><span style="color:#111">;</span>
<span style="color:#75715e">#define inf 0x3f3f3f3f
</span><span style="color:#75715e"></span><span style="color:#00a8c8">class</span> <span style="color:#75af00">tree</span>
<span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
	<span style="color:#00a8c8">struct</span> <span style="color:#75af00">node</span>
	<span style="color:#111">{</span>
		<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">father</span><span style="color:#111">;</span><span style="color:#75715e">//父节点
</span><span style="color:#75715e"></span>		<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">left</span><span style="color:#111">;</span><span style="color:#75715e">//左子树
</span><span style="color:#75715e"></span>		<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">right</span><span style="color:#111">;</span><span style="color:#75715e">//右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">max</span><span style="color:#111">;</span><span style="color:#75715e">//区间最大值
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">min</span><span style="color:#111">;</span><span style="color:#75715e">//区间最小值
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//区间和
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span><span style="color:#75715e">//区间端点
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">lazy_add</span><span style="color:#111">;</span><span style="color:#75715e">//加法标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//乘法标记
</span><span style="color:#75715e"></span>		<span style="color:#111">node</span><span style="color:#111">()</span><span style="color:#75715e">//初始化
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">father</span> <span style="color:#f92672">=</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>
			<span style="color:#111">left</span> <span style="color:#f92672">=</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>
			<span style="color:#111">right</span> <span style="color:#f92672">=</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>
			<span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">;</span>
			<span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">;</span>
			<span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//即什么都没加
</span><span style="color:#75715e"></span>			<span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span><span style="color:#75715e">//即什么都没乘
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
	<span style="color:#111">};</span>
	<span style="color:#f92672">~</span><span style="color:#111">tree</span><span style="color:#111">()</span><span style="color:#75715e">//删除整棵树
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">d_t</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//---------------------------------------------构造线段树--------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">build</span><span style="color:#111">(</span><span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span> <span style="color:#111">num</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">d_t</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">);</span><span style="color:#75715e">//删除旧树
</span><span style="color:#75715e"></span>		<span style="color:#111">nums</span> <span style="color:#f92672">=</span> <span style="color:#111">num</span><span style="color:#111">;</span><span style="color:#75715e">//赋新值
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">size</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">.</span><span style="color:#111">size</span><span style="color:#111">()</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">size</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#111">root</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">node</span><span style="color:#111">;</span>
		<span style="color:#111">root</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//根节点区间左端为0
</span><span style="color:#75715e"></span>		<span style="color:#111">root</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#111">size</span><span style="color:#111">;</span><span style="color:#75715e">//根节点区间右端为size
</span><span style="color:#75715e"></span>		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">);</span><span style="color:#75715e">//构建左子树
</span><span style="color:#75715e"></span>		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">size</span><span style="color:#111">);</span><span style="color:#75715e">//构建右子树
</span><span style="color:#75715e"></span>		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">);</span><span style="color:#75715e">//更新根节点的值
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//-----------------------------------------------查询-----------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">double</span> <span style="color:#75af00">find</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">string</span> <span style="color:#111">mode</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;max&#34;</span><span style="color:#111">)</span><span style="color:#75715e">//返回区间最大值
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;min&#34;</span><span style="color:#111">)</span><span style="color:#75715e">//返回区间最小值
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;sum&#34;</span><span style="color:#111">)</span><span style="color:#75715e">//返回区间和
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------区间加法--------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">add</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span><span style="color:#75715e">//区间l~r内每个数加k
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------区间减法--------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">multiply</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span><span style="color:#75715e">//区间l~r内.每个数乘k
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//--------------------------------------------输出整个区间-------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">out</span><span style="color:#111">()</span><span style="color:#75715e">//输出线段树包含的数
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">_out</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">);</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
<span style="color:#00a8c8">private</span><span style="color:#f92672">:</span>
	<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">root</span><span style="color:#111">;</span><span style="color:#75715e">//根节点
</span><span style="color:#75715e"></span>	<span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span><span style="color:#111">nums</span><span style="color:#111">;</span><span style="color:#75715e">//数据
</span><span style="color:#75715e"></span>	<span style="color:#75715e">//----------------------------------------------删除------------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">d_t</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span> <span style="color:#f92672">==</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span><span style="color:#75715e">//啥毛没有,咋删?
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">!=</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#111">d_t</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">);</span><span style="color:#75715e">//删除左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span> <span style="color:#f92672">!=</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#111">d_t</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">);</span><span style="color:#75715e">//删除右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">delete</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//删除自己
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------更新--------------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">);</span><span style="color:#75715e">//更新最大值
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">);</span><span style="color:#75715e">//更新最小值
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------构造---------------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#75af00">_build</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">t</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">node</span><span style="color:#111">;</span><span style="color:#75715e">//建立新节点
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#111">l</span><span style="color:#111">;</span><span style="color:#75715e">//区间左端点
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">;</span><span style="color:#75715e">//区右端点
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">father</span> <span style="color:#f92672">=</span> <span style="color:#111">t</span><span style="color:#111">;</span><span style="color:#75715e">//建立父子关系
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">==</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//若t没有左子树,说明要构建的树为其左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">else</span> <span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//反之,则为右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子节点
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span><span style="color:#75715e">//三个一样
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//返回节点地址
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">=</span><span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">);</span><span style="color:#75715e">//构造左子树
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">=</span><span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//构造右子树
</span><span style="color:#75715e"></span>		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//---------------------------------------------传递标记---------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span><span style="color:#75715e">//若没有标记,传递啥?
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子结点,无需修改其标记(根本就没标记...)
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//先乘后加
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span><span style="color:#75715e">//否则,先修改标记,再修改值
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//先乘后加
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span><span style="color:#75715e">//区间和增加传递的标记乘以区间节点个数
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//同上(本来就是复制下来的...)
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span>
		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//删除加法标记
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span><span style="color:#75715e">//删除乘法标记
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//------------------------------------------------输出----------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_out</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子节点,输出
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; &#34;</span><span style="color:#111">;</span>
			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#111">_out</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">);</span><span style="color:#75715e">//输出左子树
</span><span style="color:#75715e"></span>		<span style="color:#111">_out</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">);</span><span style="color:#75715e">//输出右子树
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//---------------------------------------------查询区间最大值----------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">double</span> <span style="color:#75af00">finda</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回最大值
</span><span style="color:#75715e"></span>		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树.查询左子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span><span style="color:#75715e">//从中间切开,分别查询,返回最大值
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#f92672">-</span><span style="color:#111">inf</span><span style="color:#111">;</span><span style="color:#75715e">//防止破坏
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//--------------------------------------------查询区间最小值-----------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">double</span> <span style="color:#75af00">findi</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回最小值
</span><span style="color:#75715e"></span>		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树,查询左子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span><span style="color:#75715e">//从中间切开,分别查询,返回最小值
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">inf</span><span style="color:#111">;</span><span style="color:#75715e">//防止破坏
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------查询区间和------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">double</span> <span style="color:#75af00">findu</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回区间和
</span><span style="color:#75715e"></span>		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//若待查询区间位于其左子树,查询左子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//若待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//从中间切开,分别查询,返回和
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">inf</span><span style="color:#111">;</span><span style="color:#75715e">//防止破坏
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//---------------------------------------------区间加法---------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_add</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间完全重合
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//若不是叶子结点,更新加法标记
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间最小值
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间最大值
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若区间完全位于其左子树,向左子树查找区间l~r并执行加法
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span>
				<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若区间完全位于其右子树,向右子树查找区间l~r并执行加法
</span><span style="color:#75715e"></span>				<span style="color:#00a8c8">else</span><span style="color:#75715e">//从中间切开,分别执行加法
</span><span style="color:#75715e"></span>				<span style="color:#111">{</span>
					<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
					<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------区间乘法--------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_multiply</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间完全重合
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//若不是叶子结点,更新乘法标记
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">k</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span><span style="color:#75715e">//若乘数为正
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最大的还是最大的
</span><span style="color:#75715e"></span>				<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最小的还是最小的
</span><span style="color:#75715e"></span>			<span style="color:#111">}</span>
			<span style="color:#00a8c8">else</span>
			<span style="color:#111">{</span>
				<span style="color:#00a8c8">double</span> <span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">;</span><span style="color:#75715e">//暂时储存
</span><span style="color:#75715e"></span>				<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最大的符号相反后变成最小的
</span><span style="color:#75715e"></span>				<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最小的符号相反后变为最大的
</span><span style="color:#75715e"></span>			<span style="color:#111">}</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新加法标记(下面每个数要加的数也乘了k)
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子节点前先更新标记
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若待操作区间完全位于左子树,向左子树查询并进行区间乘法
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span>
				<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若待操作区间完全位于右子树,向右子树查询并进行区间乘法
</span><span style="color:#75715e"></span>				<span style="color:#00a8c8">else</span><span style="color:#75715e">//从中间切开,分别进行操作
</span><span style="color:#75715e"></span>				<span style="color:#111">{</span>
					<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
					<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
<span style="color:#111">};</span>
<span style="color:#111">tree</span> <span style="color:#111">Te</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">()</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">char</span> <span style="color:#111">D</span><span style="color:#111">;</span>
<span style="color:#111">aaa</span><span style="color:#111">:</span><span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">D</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">switch</span> <span style="color:#111">(</span><span style="color:#111">D</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;B&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//构造
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">n</span><span style="color:#111">;</span>
		<span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span> <span style="color:#111">muns</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">num</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">n</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">num</span><span style="color:#111">;</span>
			<span style="color:#111">muns</span><span style="color:#111">.</span><span style="color:#111">push_back</span><span style="color:#111">(</span><span style="color:#111">num</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#111">muns</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;N&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//查询区间最小值
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;min&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;M&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//查询区间和
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;sum&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;X&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//查询区间最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;max&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;J&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//区间加法
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">add</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;C&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//区间乘法
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">multiply</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;O&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//输出
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">out</span><span style="color:#111">();</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;E&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//结束
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">goto</span> <span style="color:#111">aaa</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="数组版知道能拿数组写就好">数组版(知道能拿数组写就好)</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;algorithm&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#00a8c8">using</span> <span style="color:#00a8c8">namespace</span> <span style="color:#111">std</span><span style="color:#111">;</span>
<span style="color:#75715e">#define inf 0x3f3f3f3f
</span><span style="color:#75715e"></span><span style="color:#00a8c8">class</span> <span style="color:#75af00">tree</span>
<span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
	<span style="color:#00a8c8">struct</span> <span style="color:#75af00">node</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">max</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">min</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">sum</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">node</span><span style="color:#111">()</span>
		<span style="color:#111">{</span>
			<span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">;</span>
			<span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">;</span>
			<span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
			<span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
	<span style="color:#111">}</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#ae81ff">10000</span><span style="color:#111">];</span><span style="color:#75715e">//T[n*2+1]是T[n]的左子树,T[n*2+2]是T[n]的右子树
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">build</span><span style="color:#111">(</span><span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span> <span style="color:#111">num</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">nums</span> <span style="color:#f92672">=</span> <span style="color:#111">num</span><span style="color:#111">;</span>
		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">nums</span><span style="color:#111">.</span><span style="color:#111">size</span><span style="color:#111">()</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">double</span> <span style="color:#75af00">find</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">string</span> <span style="color:#111">mode</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;max&#34;</span><span style="color:#111">)</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;min&#34;</span><span style="color:#111">)</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;sum&#34;</span><span style="color:#111">)</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">add</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">multiply</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
<span style="color:#00a8c8">private</span><span style="color:#f92672">:</span>
	<span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span><span style="color:#111">nums</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span><span style="color:#111">);</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span><span style="color:#111">);</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_build</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#111">l</span><span style="color:#111">;</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">);</span>
		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">double</span> <span style="color:#75af00">finda</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span><span style="color:#111">;</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#f92672">-</span><span style="color:#111">inf</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">double</span> <span style="color:#75af00">findi</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span><span style="color:#111">;</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">double</span> <span style="color:#75af00">findu</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span><span style="color:#111">;</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_add</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">else</span>
				<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#00a8c8">else</span>
				<span style="color:#111">{</span>
					<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
					<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_multiply</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">k</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span>
			<span style="color:#111">{</span>
				<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
				<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">}</span>
			<span style="color:#00a8c8">else</span>
			<span style="color:#111">{</span>
				<span style="color:#00a8c8">double</span> <span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span><span style="color:#111">;</span>
				<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span>
				<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">}</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">else</span>
				<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#00a8c8">else</span>
				<span style="color:#111">{</span>
					<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
					<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
<span style="color:#111">};</span>
<span style="color:#111">tree</span> <span style="color:#111">Te</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">()</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">char</span> <span style="color:#111">D</span><span style="color:#111">;</span>
<span style="color:#111">aaa</span><span style="color:#111">:</span><span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">D</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">switch</span> <span style="color:#111">(</span><span style="color:#111">D</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;B&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">n</span><span style="color:#111">;</span>
		<span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span> <span style="color:#111">muns</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">num</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">n</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">num</span><span style="color:#111">;</span>
			<span style="color:#111">muns</span><span style="color:#111">.</span><span style="color:#111">push_back</span><span style="color:#111">(</span><span style="color:#111">num</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#111">muns</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;N&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;min&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;M&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;sum&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;X&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;max&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;J&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">add</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;C&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">multiply</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">goto</span> <span style="color:#111">aaa</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="压行版最好多打几遍背下来">压行版(最好多打几遍背下来)</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">98
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;algorithm&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#00a8c8">using</span> <span style="color:#00a8c8">namespace</span> <span style="color:#111">std</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//加法标记
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">lm</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//乘法标记
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//节点最大值
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//节点最小值
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//节点区间和
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//左端点
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//右端点
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">num</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//临时数据
</span><span style="color:#75715e"></span><span style="color:#75715e">#define ls (p&lt;&lt;1)</span><span style="color:#75715e">//左儿子
</span><span style="color:#75715e"></span><span style="color:#75715e">#define rs (ls|1)</span><span style="color:#75715e">//右儿子
</span><span style="color:#75715e"></span><span style="color:#75715e">#define mid (ln[p]+rn[p]&gt;&gt;1)
</span><span style="color:#75715e">#define a la[p]</span><span style="color:#75715e">//当前节点加法标记
</span><span style="color:#75715e"></span><span style="color:#75715e">#define m lm[p]</span><span style="color:#75715e">//当前节点减法标记
</span><span style="color:#75715e"></span><span style="color:#00a8c8">inline</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">],</span> <span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]);</span>
	<span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">],</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]);</span>
	<span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">];</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">build</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">l</span><span style="color:#111">;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">num</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
		<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">);</span> <span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span> <span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">inline</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">m</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">lm</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span>
		<span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">lm</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span>
		<span style="color:#111">lm</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">a</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">(</span><span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">-</span> <span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">a</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">(</span><span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">-</span> <span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">a</span><span style="color:#111">;</span>
		<span style="color:#111">a</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">change</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">add</span><span style="color:#75715e">/*加法*/</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">mut</span><span style="color:#75715e">/*乘法*/</span><span style="color:#111">)</span><span style="color:#75715e">//乘法优先
</span><span style="color:#75715e"></span><span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">add</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">add</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">(</span><span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">-</span> <span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">add</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">{</span> <span style="color:#111">a</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span> <span style="color:#111">a</span> <span style="color:#f92672">+=</span> <span style="color:#111">add</span><span style="color:#111">;</span> <span style="color:#111">m</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span> <span style="color:#111">}</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">add</span><span style="color:#111">,</span> <span style="color:#111">mut</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">else</span> <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">add</span><span style="color:#111">,</span> <span style="color:#111">mut</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">else</span> <span style="color:#111">{</span> <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">add</span><span style="color:#111">,</span> <span style="color:#111">mut</span><span style="color:#111">);</span> <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">add</span><span style="color:#111">,</span> <span style="color:#111">mut</span><span style="color:#111">);</span> <span style="color:#111">}</span>
	<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">mx</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">];</span>
	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">mx</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">mx</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">mx</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">mx</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">mn</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">];</span>
	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">mn</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">mn</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">return</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">mn</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">mn</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">sum</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">];</span>
	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">return</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">()</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">;</span>
	<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">n</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">n</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span> <span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">num</span><span style="color:#111">[</span><span style="color:#111">i</span><span style="color:#111">];</span>
	<span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">n</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
	<span style="color:#75715e">//change(1, 0, n - 1, 1, 2);
</span><span style="color:#75715e"></span>	<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">n</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>
                    </div>
                    
                        <div style="text-align: left; margin: 60px 0px 40px 8px; border-radius: 6px;">
    <ul class="post_tags" style="margin: 0px; padding: 0px 0px 15px; width: 100%;">
    	<li class="cat-real" style="display: inline-block; color: rgb(102, 102, 102); font-size: 1.1rem; font-weight: 600; margin: 0px; letter-spacing: 1px;">
            <a style="background-color: rgb(231, 243, 255); color: rgb(47, 148, 254); padding: 1px 12px; border-radius: 4px; font-size: 0.9rem;"></a>
        </li>
        
            <li class="cat-real" style="display: inline-block;">
                <a href="https://gbwater.ga/tags/rmq/" style="font-size: 0.9rem; border-radius: 4px; padding: 1px 12px;">RMQ</a>
            </li>
        
            <li class="cat-real" style="display: inline-block;">
                <a href="https://gbwater.ga/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.9rem; border-radius: 4px; padding: 1px 12px;">数据结构</a>
            </li>
        
            <li class="cat-real" style="display: inline-block;">
                <a href="https://gbwater.ga/tags/c&#43;&#43;/" style="font-size: 0.9rem; border-radius: 4px; padding: 1px 12px;">c&#43;&#43;</a>
            </li>
        
    </ul>
</div>
                    
                        <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    
    <div id="vcomments"></div>
    <script>
    new Valine({
        el: '#vcomments' ,
        appId: '0yETd71mzQvC5kqlVGmDIVLr-gzGzoHsz',
        appKey: 'PuVvdF6GU4JvY8RXiuHWlI5W',
        notify:false, 
        verify:false, 
        avatar:'mp', 
        placeholder: 'just go go' , 
        enableQQ:true , 
        visitor:true , 
        pageSize:15 , 
        recordIP:true
    });
    </script>
                </div>
            </div>
        </div>
    </div>
</div>

    </body>
    <div>
    <a href="https://github.com/water2004" target="_blank" style="text-decoration:none">
        <div class="goup-container footer-github">
            <i class="ri-github-fill footer-github-icon"></i>
        </div>
    </a>
    <div class="footer reveal">
        
            <p>
                Copyright&nbsp;<i class="ri-copyright-line"></i>&nbsp;·&nbsp;2021&nbsp;·&nbsp;GBwater&nbsp;·&nbsp;
                <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" style="text-decoration: none;color: inherit;font-size: 14px;font-weight: 500;">
                    CC BY-NC 4.0
                </a>
            </p>
        
        <p>
            
                Powered by <a href="https://github.com/gohugoio/hugo">Hugo</a> | Theme is <a href="https://github.com/ThemeTony/hugo-theme-tony">Tony</a>
            
        </p>
    </div>
</div>


    <script src="/js/jquery.min.js"></script><script src="/js/tony.min.21fb28b08edccb7a220a2a53f8fa67ba2f62588d04437e5a3998769b79537006.js" integrity="sha256-IfsosI7cy3oiCipT+Ppnui9iWI0EQ35aOZh2m3lTcAY="></script><script src="/js/medium-zoom.min.js"></script>
<script>
	mediumZoom(document.querySelectorAll('div.article-content img'), {
        background: '#fff'
    });
</script>


    
<script>
(function(){
	var bp = document.createElement('script');
	var curProtocol = window.location.protocol.split(':')[0];
	if (curProtocol === 'https'){
	 bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
	}
	else{
	bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	}
	var s = document.getElementsByTagName("script")[0];
	s.parentNode.insertBefore(bp, s);
})();
</script>



</html>