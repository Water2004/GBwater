<?xml version="1.0" encoding="utf-8"?>






<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>HUGO-THEME-TONY</title>
        <link>http://example.com/</link>
        <description></description>
        <generator>Hugo 0.80.0 https://gohugo.io/</generator>
        
            <language>cn</language>
        
        
            <managingEditor>mail@example.com (HUGO-THEME-TONY)</managingEditor>
        
        
            <webMaster>mail@example.com (HUGO-THEME-TONY)</webMaster>
        
        
        <lastBuildDate>Wed, 10 Feb 2021 12:29:35 +0800</lastBuildDate>
        
            <atom:link rel="self" type="application/rss+xml" href="http://example.com/rss.xml" />
        
        
            
                <item>
                    <title>Hello World</title>
                    <link>http://example.com/posts/hello-world/</link>
                    <guid isPermaLink="true">http://example.com/posts/hello-world/</guid>
                    <pubDate>Fri, 01 Jan 2021 10:43:00 +0800</pubDate>
                    <description><![CDATA[]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>倍增LCA</title>
                    <link>http://example.com/posts/%E5%80%8D%E5%A2%9Elca/</link>
                    <guid isPermaLink="true">http://example.com/posts/%E5%80%8D%E5%A2%9Elca/</guid>
                    <pubDate>Sun, 15 Nov 2020 00:00:00 +0000</pubDate>
                    <description><![CDATA[<h1 id="倍增lca">倍增LCA</h1>

<h2 id="引子">引子</h2>

<p>什么？你还不知道什么是LCA？LCA就是树上两个节点的最近公共祖先。<br>
所以，对于怎么找LCA，是个人都会想到一个办法，让两个节点不断向上移动，只要重合了就是LCA了，嘿嘿嘿<br>
然鹅，一个一个移动太慢，只要数据过了 $10^8$ 分分钟 T 飞~<br>
所以，我们需要一个快速的移动方式，比如，成几何级数的移动，这就是倍增算法</p>

<h2 id="基本思路">基本思路</h2>

<p>既然要成几何级数的移动速度，要找个底数，比如2吧，每次移动 $2^k$ 个<br>
要想一次移动这么多，肯定要预处理，不如先预处理一个数组 $grand[i][j]$ 表示 $i$ 向上跳<span  class="math">\(2^k\)</span>个是谁，跳出这棵树的值就为-1吧<br>
怎么判断已经跳到了LCA呢？毕竟公共祖先不只有LCA一个<br>
不如就不直接跳到LCA，把所有跳到相同节点的情况都视为跳出树了，一直跳直到跳不动了为止，这时候两个节点的父节点就是LCA了，是不是特别机智~</p>

<h2 id="预处理">预处理</h2>

<p>怎么预处理出 $grand$数组呢？
什么？你想一个个往上跳，然后取对数？省省吧，有这功夫早就 T 飞了，我们需要一个更高效的方法，最好能利用已经求出的 $grand$ 数组<br>
那不就是动态规划嘛，让我们来凑一手状态转移方程<br>
首先，$i$ 向上跳 $2^k$ 个可以分解成两个动作，先向上跳 $2^{k-1}$ 个，再向上跳 $2^{k-1}$ 个<br>
$i$向上跳 $2^{k-1}$ 个不就是$grand[i][k-1]$嘛，套个娃，再向上跳 $2^{k-1}$ 个当然就是 $grand[grand[i][k-1]][k-1]$ 。于是我们得出方程：
<span  class="math">\(
grand[i][k]=grand[grand[i][k-1]][k-1]
\)</span>
瞅瞅这个方程，我们该用什么算法呢？<br>
要想转移状态，必须要先求出 $grand[i][k-1]$，这告诉我们应该：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">k</span><span style="color:#f92672">=</span><span style="color:#111">;</span><span style="color:#111">k</span><span style="color:#f92672">&lt;</span> <span style="color:#111">MAXON</span><span style="color:#111">;</span><span style="color:#111">k</span><span style="color:#f92672">++</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
  <span style="color:#75715e">//求grand
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>再看，我们还要先求出$i$的祖先节点的$grand$，因为我们要用到$grand[grand[i][k-1]][k-1]$ 嘛，这好说，来一手 $dfs$ 深度优先搜索就好了，顺便还可以记录每个节点的父节点和深度，一举两得<br>
于是我们竟然可以写出代码了
先用邻接表存图：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">	<span style="color:#00a8c8">struct</span> <span style="color:#75af00">edge</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">to</span><span style="color:#111">;</span><span style="color:#75715e">//这条边到达的点
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">next</span><span style="color:#111">;</span><span style="color:#75715e">//下一条边
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span><span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">MAXON</span><span style="color:#111">];</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">head</span><span style="color:#111">[</span><span style="color:#111">MAXON</span><span style="color:#111">];</span><span style="color:#75715e">//head[i]表示由i开始的第一条边的编号
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">int</span> <span style="color:#111">tot</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//总边数
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">int</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#ae81ff">500010</span><span style="color:#111">][</span><span style="color:#ae81ff">30</span><span style="color:#111">];</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">fa</span><span style="color:#111">[</span><span style="color:#111">MAXON</span><span style="color:#111">];</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">add_dege</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">from</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">to</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">tot</span><span style="color:#f92672">++</span><span style="color:#111">;</span><span style="color:#75715e">//当前边的编号
</span><span style="color:#75715e"></span>		<span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">tot</span><span style="color:#111">].</span><span style="color:#111">to</span> <span style="color:#f92672">=</span> <span style="color:#111">to</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">from</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
			<span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">tot</span><span style="color:#111">].</span><span style="color:#111">next</span> <span style="color:#f92672">=</span> <span style="color:#111">head</span><span style="color:#111">[</span><span style="color:#111">from</span><span style="color:#111">];</span><span style="color:#75715e">//插入在前
</span><span style="color:#75715e"></span>		<span style="color:#111">head</span><span style="color:#111">[</span><span style="color:#111">from</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">tot</span><span style="color:#111">;</span><span style="color:#75715e">//由于这条边插入在了前面,故当前边就是由from开始的第一条边
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">dfs</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">from</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">now</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">fa</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">from</span><span style="color:#111">;</span><span style="color:#75715e">//记录父节点
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">start</span> <span style="color:#f92672">=</span> <span style="color:#111">head</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">];</span><span style="color:#75715e">//从第一个子节点开始找
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">from</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span><span style="color:#75715e">//若不是根节点,深度为父节点深度+1(根节点为0)
</span><span style="color:#75715e"></span>			<span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">from</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
		<span style="color:#75715e">//int g = log2(dep[now]) ;
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">g</span> <span style="color:#f92672">=</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">]];</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">from</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span><span style="color:#75715e">//根节点没有父节点
</span><span style="color:#75715e"></span>			<span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">][</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">from</span><span style="color:#111">;</span><span style="color:#75715e">//2^0=1,即父节点
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#f92672">=</span> <span style="color:#111">g</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">][</span><span style="color:#111">i</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">]][</span><span style="color:#111">i</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">];</span><span style="color:#75715e">//状态转移方程
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">start</span><span style="color:#111">)</span><span style="color:#75715e">//一个一个找孩子
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">start</span><span style="color:#111">].</span><span style="color:#111">to</span> <span style="color:#f92672">==</span> <span style="color:#111">from</span><span style="color:#111">)</span><span style="color:#75715e">//若相连节点不是父节点
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">start</span> <span style="color:#f92672">=</span> <span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">start</span><span style="color:#111">].</span><span style="color:#111">next</span><span style="color:#111">;</span>
				<span style="color:#00a8c8">continue</span><span style="color:#111">;</span>
			<span style="color:#111">}</span>
			<span style="color:#111">dfs</span><span style="color:#111">(</span><span style="color:#111">now</span><span style="color:#111">,</span> <span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">start</span><span style="color:#111">].</span><span style="color:#111">to</span><span style="color:#111">);</span><span style="color:#75715e">//继续搜索子节点
</span><span style="color:#75715e"></span>			<span style="color:#111">start</span> <span style="color:#f92672">=</span> <span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">start</span><span style="color:#111">].</span><span style="color:#111">next</span><span style="color:#111">;</span><span style="color:#75715e">//搜索下一个子节点
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
	<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="跳">跳！</h2>

<p>预处理好了，接下来就是跳了<br>
怎么跳呢？先跳到同一高度，然后什么都好说</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">]</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">])</span><span style="color:#75715e">//统一b深度大于a
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">a</span> <span style="color:#f92672">=</span> <span style="color:#111">a</span> <span style="color:#f92672">+</span> <span style="color:#111">b</span><span style="color:#111">;</span><span style="color:#75715e">//a此时等于原来的a,b之和
</span><span style="color:#75715e"></span>			<span style="color:#111">b</span> <span style="color:#f92672">=</span> <span style="color:#111">a</span> <span style="color:#f92672">-</span> <span style="color:#111">b</span><span style="color:#111">;</span><span style="color:#75715e">//b此时等于原来的a
</span><span style="color:#75715e"></span>			<span style="color:#111">a</span> <span style="color:#f92672">=</span> <span style="color:#111">a</span> <span style="color:#f92672">-</span> <span style="color:#111">b</span><span style="color:#111">;</span><span style="color:#75715e">//a此时等于原来的b
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span><span style="color:#75715e">//神奇的交换方法
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">deep</span> <span style="color:#f92672">=</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">]</span> <span style="color:#f92672">-</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">];</span><span style="color:#75715e">//深度差
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//int step = log2(deep);
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">step</span> <span style="color:#f92672">=</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">deep</span><span style="color:#111">];</span><span style="color:#75715e">//最大要走的步数
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#111">step</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">--</span><span style="color:#111">)</span><span style="color:#75715e">//先让b跳到和a同一深度
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">]]</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">])</span> <span style="color:#00a8c8">continue</span><span style="color:#111">;</span><span style="color:#75715e">//跳过头了,不跳
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span>
			<span style="color:#111">{</span>
				<span style="color:#111">b</span> <span style="color:#f92672">=</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">];</span><span style="color:#75715e">//没跳过头,跳
</span><span style="color:#75715e"></span>			<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">a</span> <span style="color:#f92672">==</span> <span style="color:#111">b</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">a</span><span style="color:#111">;</span><span style="color:#75715e">//若相等,则已经找到LCA
</span></code></pre></td></tr></table>
</div>
</div>
<p>这里为什么要有个step呢，因为先封个顶，一点点下降，能跳再跳，万一就跳出去了呢<br>
然后就是两个节点一起向上跳了</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">		<span style="color:#111">step</span> <span style="color:#f92672">=</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">]];</span> <span style="color:#75715e">//要走的步数
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//step = log2(dep[a]);
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#111">step</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">--</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">])</span> <span style="color:#00a8c8">continue</span><span style="color:#111">;</span><span style="color:#75715e">//跳过头了,不跳
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span><span style="color:#75715e">//没跳过头,跳
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">a</span> <span style="color:#f92672">=</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">];</span>
				<span style="color:#111">b</span> <span style="color:#f92672">=</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">];</span>
			<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">fa</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">];</span><span style="color:#75715e">//最后他们的父节点就是LC
</span></code></pre></td></tr></table>
</div>
</div>
<p>要问这个$lg$数组是怎么来的？洛谷上抄的，嘿嘿嘿</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">	<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#f92672">=</span> <span style="color:#111">n</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span> <span style="color:#75715e">//常数优化,预先算出log_2(i)+1的值，用的时候直接调用就可以了
</span><span style="color:#75715e"></span>		<span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">i</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">i</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#111">(</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">i</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">i</span><span style="color:#111">);</span>  <span style="color:#75715e">//看不懂的可以手推一下
</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="完整代码">完整代码</h2>

<p>我写这玩意的时候特别喜欢class，于是。。。码风奇丑，凑合着看吧。。。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;cmath&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;cstdio&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#00a8c8">using</span> <span style="color:#00a8c8">namespace</span> <span style="color:#111">std</span><span style="color:#111">;</span>
<span style="color:#00a8c8">const</span> <span style="color:#00a8c8">int</span> <span style="color:#111">MAXON</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000010</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">MAXON</span><span style="color:#111">];</span><span style="color:#75715e">//dep[i]代表编号为i的点所处的深度
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">MAXON</span><span style="color:#111">];</span>
<span style="color:#00a8c8">class</span> <span style="color:#75af00">Graph</span>
<span style="color:#111">{</span>
<span style="color:#00a8c8">private</span><span style="color:#f92672">:</span>
	<span style="color:#00a8c8">struct</span> <span style="color:#75af00">edge</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">to</span><span style="color:#111">;</span><span style="color:#75715e">//这条边到达的点
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">next</span><span style="color:#111">;</span><span style="color:#75715e">//下一条边
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span><span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">MAXON</span><span style="color:#111">];</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">head</span><span style="color:#111">[</span><span style="color:#111">MAXON</span><span style="color:#111">];</span><span style="color:#75715e">//head[i]表示由i开始的第一条边的编号
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">int</span> <span style="color:#111">tot</span><span style="color:#111">;</span><span style="color:#75715e">//总边数
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">int</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#ae81ff">500010</span><span style="color:#111">][</span><span style="color:#ae81ff">30</span><span style="color:#111">];</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">fa</span><span style="color:#111">[</span><span style="color:#111">MAXON</span><span style="color:#111">];</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
	<span style="color:#111">Graph</span><span style="color:#111">()</span>
	<span style="color:#111">{</span>
		<span style="color:#111">tot</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">add_dege</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">from</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">to</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">tot</span><span style="color:#f92672">++</span><span style="color:#111">;</span><span style="color:#75715e">//当前边的编号
</span><span style="color:#75715e"></span>		<span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">tot</span><span style="color:#111">].</span><span style="color:#111">to</span> <span style="color:#f92672">=</span> <span style="color:#111">to</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">from</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
			<span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">tot</span><span style="color:#111">].</span><span style="color:#111">next</span> <span style="color:#f92672">=</span> <span style="color:#111">head</span><span style="color:#111">[</span><span style="color:#111">from</span><span style="color:#111">];</span><span style="color:#75715e">//插入在前
</span><span style="color:#75715e"></span>		<span style="color:#111">head</span><span style="color:#111">[</span><span style="color:#111">from</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">tot</span><span style="color:#111">;</span><span style="color:#75715e">//由于这条边插入在了前面,故当前边就是由from开始的第一条边
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">dfs</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">from</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">now</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">fa</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">from</span><span style="color:#111">;</span><span style="color:#75715e">//记录父节点
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">start</span> <span style="color:#f92672">=</span> <span style="color:#111">head</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">];</span><span style="color:#75715e">//从第一个子节点开始找
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">from</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span><span style="color:#75715e">//若不是根节点,深度为父节点深度+1(根节点为0)
</span><span style="color:#75715e"></span>			<span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">from</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
		<span style="color:#75715e">//int g = log2(dep[now]) ;
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">g</span> <span style="color:#f92672">=</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">]];</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">from</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span><span style="color:#75715e">//根节点没有父节点
</span><span style="color:#75715e"></span>			<span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">][</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">from</span><span style="color:#111">;</span><span style="color:#75715e">//2^0=1,即父节点
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">g</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">now</span><span style="color:#111">][</span><span style="color:#111">i</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">]][</span><span style="color:#111">i</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">];</span><span style="color:#75715e">//状态转移方程
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">start</span><span style="color:#111">)</span><span style="color:#75715e">//一个一个找孩子
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">start</span><span style="color:#111">].</span><span style="color:#111">to</span> <span style="color:#f92672">==</span> <span style="color:#111">from</span><span style="color:#111">)</span><span style="color:#75715e">//若相连节点不是父节点
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">start</span> <span style="color:#f92672">=</span> <span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">start</span><span style="color:#111">].</span><span style="color:#111">next</span><span style="color:#111">;</span>
				<span style="color:#00a8c8">continue</span><span style="color:#111">;</span>
			<span style="color:#111">}</span>
			<span style="color:#111">dfs</span><span style="color:#111">(</span><span style="color:#111">now</span><span style="color:#111">,</span> <span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">start</span><span style="color:#111">].</span><span style="color:#111">to</span><span style="color:#111">);</span><span style="color:#75715e">//继续搜索子节点
</span><span style="color:#75715e"></span>			<span style="color:#111">start</span> <span style="color:#f92672">=</span> <span style="color:#111">Edge</span><span style="color:#111">[</span><span style="color:#111">start</span><span style="color:#111">].</span><span style="color:#111">next</span><span style="color:#111">;</span><span style="color:#75715e">//搜索下一个子节点
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">int</span> <span style="color:#75af00">lca</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">a</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">b</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">]</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">])</span><span style="color:#75715e">//统一b深度大于a
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">a</span> <span style="color:#f92672">=</span> <span style="color:#111">a</span> <span style="color:#f92672">+</span> <span style="color:#111">b</span><span style="color:#111">;</span><span style="color:#75715e">//a此时等于原来的a,b之和
</span><span style="color:#75715e"></span>			<span style="color:#111">b</span> <span style="color:#f92672">=</span> <span style="color:#111">a</span> <span style="color:#f92672">-</span> <span style="color:#111">b</span><span style="color:#111">;</span><span style="color:#75715e">//b此时等于原来的a
</span><span style="color:#75715e"></span>			<span style="color:#111">a</span> <span style="color:#f92672">=</span> <span style="color:#111">a</span> <span style="color:#f92672">-</span> <span style="color:#111">b</span><span style="color:#111">;</span><span style="color:#75715e">//a此时等于原来的b
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span><span style="color:#75715e">//神奇的交换方法
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">deep</span> <span style="color:#f92672">=</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">]</span> <span style="color:#f92672">-</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">];</span><span style="color:#75715e">//深度差
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//int step = log2(deep);
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">step</span> <span style="color:#f92672">=</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">deep</span><span style="color:#111">];</span><span style="color:#75715e">//最大要走的步数
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#111">step</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">--</span><span style="color:#111">)</span><span style="color:#75715e">//先让b跳到和a同一深度
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">]]</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">])</span> <span style="color:#00a8c8">continue</span><span style="color:#111">;</span><span style="color:#75715e">//跳过头了,不跳
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span>
			<span style="color:#111">{</span>
				<span style="color:#111">b</span> <span style="color:#f92672">=</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">];</span><span style="color:#75715e">//没跳过头,跳
</span><span style="color:#75715e"></span>			<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">a</span> <span style="color:#f92672">==</span> <span style="color:#111">b</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">a</span><span style="color:#111">;</span><span style="color:#75715e">//若相等,则已经找到LCA
</span><span style="color:#75715e"></span>		<span style="color:#111">step</span> <span style="color:#f92672">=</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">dep</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">]];</span> <span style="color:#75715e">//要走的步数
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//step = log2(dep[a]);
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#111">step</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">--</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">])</span> <span style="color:#00a8c8">continue</span><span style="color:#111">;</span><span style="color:#75715e">//跳过头了,不跳
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span><span style="color:#75715e">//没跳过头,跳
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">a</span> <span style="color:#f92672">=</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">];</span>
				<span style="color:#111">b</span> <span style="color:#f92672">=</span> <span style="color:#111">grand</span><span style="color:#111">[</span><span style="color:#111">b</span><span style="color:#111">][</span><span style="color:#111">i</span><span style="color:#111">];</span>
			<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">fa</span><span style="color:#111">[</span><span style="color:#111">a</span><span style="color:#111">];</span><span style="color:#75715e">//最后他们的父节点就是LCA
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
<span style="color:#111">};</span>
<span style="color:#111">Graph</span> <span style="color:#111">G</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">()</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#111">m</span><span style="color:#111">,</span> <span style="color:#111">s</span><span style="color:#111">;</span>
	<span style="color:#75715e">//cin &gt;&gt; n &gt;&gt; m &gt;&gt; s;
</span><span style="color:#75715e"></span>	<span style="color:#111">scanf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%d%d%d&#34;</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#111">m</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#111">s</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">n</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span> <span style="color:#75715e">//常熟优化,预先算出log_2(i)+1的值，用的时候直接调用就可以了
</span><span style="color:#75715e"></span>		<span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">i</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">i</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#111">(</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">lg</span><span style="color:#111">[</span><span style="color:#111">i</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">i</span><span style="color:#111">);</span>  <span style="color:#75715e">//看不懂的可以手推一下
</span><span style="color:#75715e"></span>	<span style="color:#111">n</span><span style="color:#f92672">--</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#f92672">--</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">a</span><span style="color:#111">,</span> <span style="color:#111">b</span><span style="color:#111">;</span>
		<span style="color:#75715e">//cin &gt;&gt; a &gt;&gt; b;
</span><span style="color:#75715e"></span>		<span style="color:#111">scanf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%d%d&#34;</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#111">a</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#111">b</span><span style="color:#111">);</span>
		<span style="color:#111">G</span><span style="color:#111">.</span><span style="color:#111">add_dege</span><span style="color:#111">(</span><span style="color:#111">a</span><span style="color:#111">,</span> <span style="color:#111">b</span><span style="color:#111">);</span>
		<span style="color:#111">G</span><span style="color:#111">.</span><span style="color:#111">add_dege</span><span style="color:#111">(</span><span style="color:#111">b</span><span style="color:#111">,</span> <span style="color:#111">a</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#111">G</span><span style="color:#111">.</span><span style="color:#111">dfs</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">s</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">while</span> <span style="color:#111">(</span><span style="color:#111">m</span><span style="color:#f92672">--</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">a</span><span style="color:#111">,</span> <span style="color:#111">b</span><span style="color:#111">;</span>
		<span style="color:#75715e">//cin &gt;&gt; a &gt;&gt; b;
</span><span style="color:#75715e"></span>		<span style="color:#111">scanf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%d%d&#34;</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#111">a</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#111">b</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">ans</span> <span style="color:#f92672">=</span> <span style="color:#111">G</span><span style="color:#111">.</span><span style="color:#111">lca</span><span style="color:#111">(</span><span style="color:#111">a</span><span style="color:#111">,</span> <span style="color:#111">b</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">ans</span> <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
			<span style="color:#111">printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%d</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">,</span> <span style="color:#111">s</span><span style="color:#111">);</span>
		<span style="color:#75715e">//cout &lt;&lt; s &lt;&lt; endl;
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">else</span>
			<span style="color:#111">printf</span><span style="color:#111">(</span><span style="color:#d88200">&#34;%d</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">,</span> <span style="color:#111">ans</span><span style="color:#111">);</span>
		<span style="color:#75715e">//cout &lt;&lt; ans &lt;&lt; endl;
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                    
                        
                    
                    
                        
                            
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/categories/oi/">OI</category>
                                    
                                
                            
                        
                            
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/lca/">LCA</category>
                                    
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/%E5%80%8D%E5%A2%9E/">倍增</category>
                                    
                                
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>静默拷文件</title>
                    <link>http://example.com/posts/%E9%9D%99%E9%BB%98%E6%8B%B7%E6%96%87%E4%BB%B6/</link>
                    <guid isPermaLink="true">http://example.com/posts/%E9%9D%99%E9%BB%98%E6%8B%B7%E6%96%87%E4%BB%B6/</guid>
                    <pubDate>Wed, 22 Jul 2020 00:00:00 +0000</pubDate>
                    <description><![CDATA[<h2 id="重中之重br">重中之重<br></h2>
<ul>
<li>
<p><font size=4> <strong>GUI版运行需要安装 .NET 4.7.2！！！</strong></font>
若未安装，请运行：“NDP472-KB4054530-x86-x64-AllOS-ENU.exe”安装<br></p>
</li>
<li>
<p><font size=4> <strong>5.0的setting.txt和其他版本的不兼容,不可互换！！！</strong></font></p>
</li>
<li>
<p>由于使用了Qt，可能会导致兼容性问题</p>
</li>
</ul>
<h2 id="简介">简介</h2>
<ul>
<li>实现在检测到<del>u盘</del>目录存在后将<del>u盘</del>目录中的文件复制到制定目录中</li>
<li>实现盘符和磁盘名称两种方法检测 <del>用来复制指定u盘的文件</del></li>
<li>复制时保留源目录结构<del>就是不仅把ppt搞出来还按原方式分文件夹</del></li>
<li>如有bitlocker锁，则等待解锁后复制<del>就是u盘有密码也可以</del></li>
<li>经测试可正确运行于Windows10（2004），其他系统本蒟蒻就不知道了<del>其实是懒得试</del><br></li>
<li>使用C++和Qt编写主程序<br></li>
<li>wpf+C# .net实现图形化 <del>（本来用的是winform+VB .net，但嫌它丑）</del><br></li>
<li>使用命令行工具“ROBOCOPY”实现相关功能 <del>本蒟蒻懒得敲</del><br></li>
<li>源代码也一并奉上，欢迎各位大神指导！如有雷同，纯属巧合<br></li>
<li>因使用此工具造成的损失本蒟蒻概不负责<del>强行甩锅，逃。。。</del><br></li>
<li>......</li>
</ul>
<h2 id="v-500更新内容">v 5.0.0更新内容</h2>
<ul>
<li>使用Qt+C++编写主程序</li>
<li>新增检测方式——磁盘名称</li>
<li>新增复制前等待选项，避让使用高峰期</li>
<li>更换bitlocker解锁检测方式，减小资源消耗</li>
</ul>
<h2 id="使用说明">使用说明</h2>
<ul>
<li><font size=4> <strong>编辑配置文件</strong></font></li>
</ul>
<ol>
<li>编辑“setup.txt”完成配置</li>
<li>运行“start无提示.vbs”或“start有提示.vbs”运行程序，等待u盘插入（切不可直接运行copy.exe!）</li>
<li>u盘插入后，程序自动复制文件</li>
<li>待u盘拔出后，检查复制出来的文件，若有需要，打开“log.txt”查看日志并进行下一步操作</li>
</ol>
<ul>
<li><font size=4> <strong>使用GUI配置工具（推荐）</strong></font></li>
</ul>
<ol>
<li>运行静默拷文件.exe，完成配置后，点击保存并启动按钮（高级选项 is useful，但不了解建议不要勾选）</li>
<li>u盘插入后，程序自动复制文件</li>
<li>待u盘拔出后，检查复制出来的文件，若有需要，可以查看日志并进行下一步操作</li>
</ol>
<ul>
<li>
<p><font size=4> <strong>“setup.txt”的填写及修改说明</strong></font></p>
<ul>
<li>请填写在提示字符的下一行（已留空，直接填在空行就好）</li>
<li>留空代表不使用该选项</li>
<li>删除时请留出空行，即各提示字符间必须留有一行空行，多了少了都不行</li>
<li>本蒟蒻已预先填写好一些内容，均可修改。但(不建议修改）的内容不建议修改及删除（大神请随意）</li>
</ul>
</li>
<li>
<p><font size=4> <strong>“start无提示.vbs”和“start有提示.vbs”</strong></font>
无提示则复制完成后不会有任何反应，有提示则复制完成后会有一“您的资料已被盗！”弹窗弹出</p>
</li>
</ul>
<h2 id="setuptxt配置选项">setup.txt”配置选项</h2>
<center>配置名</center> | <center>说明</center> | <center>填写说明</center> | <center>样例</center>
:-------|:-----------|:------|:--
文件源模式|按何种方式检测文件源|0:盘符，1:磁盘名称|0
文件源|即从哪个目录复制，记得写卷标或绝对路径或磁盘名称|若留空，即自动检测盘符|C: D: E: F:\hhh\hhh EFI
文件名|即复制什么文件，可以使用“*”|可以填写多个，用空格隔开<br>若留空，即复制源目录下所有文件| *.ppt *.pptx
目标目录|即复制到哪里，记得写路径|需为文件夹<br>若留空，则自动在程序目录下建立一个名为files的文件夹|C:\Users\32154\Desktop
文件最大限制|即只复制大小不大于此限制的文件|单位是字节<br>1MB=1024KB<br>1KB=1024字节|0
文件最小限制|即只复制大小不小于此限制的文件|单位是字节<br>1MB=1024KB<br>1KB=1024字节|0
最长的文件存在时间||日期或数字|20180203意为只复制2018年2月3日及以后复制进文件源的文件；<br>10意为只复制10天以内复制进文件源的文件
最短的文件存在时间|如填20180203，意为只复制2018年2月3日及以前复制进文件源的文件，如填10，意为只复制10天以前复制进文件源的文件
最大的最后访问日期||日期|20180203意为只复制2018年2月3日及以后使用过的文件
最小的最后访问日期||日期|20180203意为只复制2018年2月3日及以后未使用的文件
失败副本的重试次数|若复制失败，重新尝试复制该文件的次数|数字|0
两次重试间的等待时间|若复制失败，下一次尝试前的等待时间|数字|0
仅复制源目录树的前 n 层|只复制文件源前n个文件夹中的文件|数字|5
使用 n 个线程进行多线程复制|同时复制多个文件|n越大复制速度可能越高，但正常使用受到的影响也越大|1
日志文件||不可修改|log.txt
等待时间|检测u盘插入与再次检测，检测到u盘插入与开始复制文件，检测bitlocker解锁与再次检测之间的时间间隔|越大资源消耗越少|500
程序包间间隔|释放低速线路上的带宽|单位是毫秒(1s=1000s)复制速度会有所降低|200
自动建立文件夹|自动在目标目录下新建文件夹并将文件存入其中|1或2(1 代表建立， 2 代表不建立)|1
复制前的等待时间|检测到磁盘可访问与开始复制之间的时间|数字，单位为秒|120
<h2 id="运行截图">运行截图</h2>
<center><img src="https://s1.ax1x.com/2020/07/22/UHSWuV.png" style="zoom:80%" /></center>
<h2 id="下载">下载</h2>
<p><a href="https://www.fengniaopan.com/#/s/5WV7fp">蜂鸟云盘</a><br>
<a href="https://github.com/water2004/Silent-Copy-From-USB-Drives">github项目地址</a></p>
]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/%E7%94%B5%E6%95%99%E5%B9%B3%E5%8F%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E9%9B%86/">电教平台自动化管理工具集</category>
                                    
                                
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>偏微分</title>
                    <link>http://example.com/posts/%E5%81%8F%E5%BE%AE%E5%88%86/</link>
                    <guid isPermaLink="true">http://example.com/posts/%E5%81%8F%E5%BE%AE%E5%88%86/</guid>
                    <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
                    <description><![CDATA[<p><strong>这篇文章挺短的，因为我也不怎么会…(⊙_⊙;)…</strong></p>
<h1 id="引子">引子</h1>
<p>众所周知，用导数可以求一个函数的最值<br>
<br>
如果...要求的东西不是函数呢？<br>
比如：
$$
a^2+b^2-2ab
$$
一般的做法肯定是均值不等式：
$$
a^2+b^2-2ab \ge 2ab-2ab =0
$$
但如果复杂到均值不等式做不了呢？<br>
大佬：“那就来一把柯西，没有一把柯西搞不定的东西，如果有，就用两把！”<br>
<br>
当然，我们不是大佬，用一点蠢一点的办法，比如 <strong>”偏微分“</strong></p>
<h1 id="栗子">栗子</h1>
<p>我们会求单变量函数的最值，能不能想办法把两个变量化成一个变量呢？<br>
<br>
不如我们先把 $b$ 当成常数，如果无论 $b$ 取何值，$a$ 原式永远在 $a$取同一个值时取到最小值，那么当原式取到最小值时，$a$ 一定等于这个值<br>
$b$ 也是同理<br>
这样我们只要把这两个值肝出来，问题就解决了嘛q(≧▽≦q)，至于方法，肯定是求导啊<br>
看不懂？我们来试一下:<br>
<br>
先把$b$当成常数，求其导数：
$$
{\partial \over \partial  a}\cdot (a^2+b^2-2ab)=2a-2b
$$
令其等于0:
$$
\Rightarrow a=b
$$
故$a=b$时原式取到最小值(需要讨论，此处省略)<br>
<br>
同样地，把$a$当成常数，求其导数：
$$
{\partial \over \partial  b} (a^2+b^2-2ab)=2b-2a
$$
令其等于0：
$$
\Rightarrow a=b
$$
故$a=b$时原式取到最小值(需要讨论，此处省略)<br>
综上所述，$a=b$时原式取到最小值，为0<br>
<br>
注意到: $d\rightarrow \partial$ 了吗？$d$ 表示常微分，$\partial$ 表示偏微分(微的都不是单变量函数了，当然得换一个)<br>
至于为什么上面单独有一个$\partial$ ,那是因为右边那一坨太大了，怼上去不好看，所以单独拿出来，只留一个$\partial$ 在上面</p>
<h1 id="本质">本质</h1>
<p>还是看不懂，那让我们看看偏微分的本质<br>
<br>
函数为什么一定是一个单变量的呢？为什么不能有两个自变量呢？<br>
当然可以，专业点，这个东西叫 <strong>二元函数</strong><br>
<br>
既然是个函数，就可以化它的图像啦，不如看看$f(x,y)=x^2+y^2-2xy$的图像：<br>
<img src="https://s1.ax1x.com/2020/07/22/UH62DO.png" alt="UH62DO.png"><br>
这玩意变成一个立体图了！o((⊙﹏⊙))o.
联系一下一元函数取最值的情况——切线水平<br>
不难推测，二元函数取最值的情况是：<strong>切面水平</strong>
<br>
切面水平，怎么表示呢？<br>
<br>
显然，如果一个平面和一个曲面相切，过切点的任何一个面截这两个面所得的直线和曲线一定相切，反之亦然 (此处不严谨)<br>
所以我们只要找两条直线就好啦~<br>
所以我们只要找两个截面就行啦~<br>
截面当然是沿x轴一个沿y轴一个最方便啦~<br>
要问x轴上的截面截得的两条线的解析式当然令x等于一个固定值就行啦，y轴也一样~ <br>
<img src="https://s1.ax1x.com/2020/07/22/UHRxmV.png" alt="看不懂，没关系">
把x当成常数，导数就是这个曲面在沿x截面截得的曲线的切点的斜率随y变化的关系<br>
反之亦然<br>
我们只需要令这两个导数等于0，就确定了水平两条相交直线，并且这两条直线还与图像相切<br>
这样就确定了水平的切面<br>
进而就可以求出最大值<br>
<br>
以上部分看懂了最好，看不懂也没关系 （因为我写的也很绕(。_。)）
但只要记住：</p>
<ol>
<li>把一个变量当常数，求导，令导数等于0，得到一条方程</li>
<li>把另一个变量当常数，求导，令导数等于0，得到另一条方程</li>
<li>......</li>
<li>解这些方程，得到个个变量的值</li>
<li>把这些值带入原式，得到最值(此处还需讨论一下)</li>
</ol>
<p>就可以使用了</p>
<h1 id="应用">应用</h1>
<p>有了这么强大的工具，我们干点什么好呢？<br>
不如来推导一下回归直线的最小二乘法的公式~<br>
<br>
有一堆点：
$$
(x_1,y_1) , (x_2,y_2) , (x_3,y_3) ... (x_n,y_n)
$$
设回归直线为
$$
y=ax+b
$$
那么原来的点在直线上就是：
$$
(x_1,ax_1+b) , (x_2,ax_2+b) , (x_3,ax_3+b) ... (x_n,ax_n+b)<br>
$$
纵坐标的方差(类似？)的n倍就是：
$$
\begin{aligned}
n\sigma^2 &amp;=\sum_{i=1}^n (ax_i+b-y_i)^2=a^2\sum_{i=1}^n x_i^2+2ab\sum_{i=1}^nx_i-2a\sum_{i=1}^nx_iy_i+nb^2+\sum_{i=1}^ny_i^2-2b\sum_{i=1}^ny_i\<br>
&amp;=a^2\sum_{i=1}^n x_i^2+2nab\overline x-2a\sum_{i=1}^nx_iy_i+nb^2+\sum_{i=1}^ny_i^2-2nb\overline y
\end{aligned}
$$
当其取到最小值时，偏导数为0
<br>
对$a$求偏导：
$$
{\partial (n\sigma^2)\over \partial a}  = 2a\sum_{i=1}^nx_i^2+2nb\overline x-2\sum_{i=1}^nx_iy_i
$$
令其等于零：
$$
\Rightarrow a\sum_{i=1}^nx_i^2+nb\overline x-\sum_{i=1}^nx_iy_i=0·····(1)
$$
对$b$求偏导：
$$
{\partial (n\sigma^2)\over \partial b} = 2na\overline x+2nb-2n\overline y\<br>
$$
令其等于0：
$$
\Rightarrow a\overline x+b=\overline y \Rightarrow b=\overline y-a\overline x
$$
代入(1)式得：
$$
a\sum_{i=1}^nx_i^2+n\overline x(\overline y-ax\overline )-\sum_{i=1}^nx_iy_i=0\<br>
\Rightarrow a={\sum_{i=1}^n x_iy_i-n\overline x\overline y\over \sum_{i=1}^n x_i^2-n\overline x^2}
$$
推导完成，完结撒花 ✿✿ヽ(°▽°)ノ✿</p>
]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/%E6%95%B0%E5%AD%A6/">数学</category>
                                    
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/%E5%BE%AE%E7%A7%AF%E5%88%86/">微积分</category>
                                    
                                
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>导数</title>
                    <link>http://example.com/posts/%E5%AF%BC%E6%95%B0/</link>
                    <guid isPermaLink="true">http://example.com/posts/%E5%AF%BC%E6%95%B0/</guid>
                    <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
                    <description><![CDATA[<h1 id="引子">引子</h1>
<p>数学的很多分支都是由物理发展来的，微积分也不例外。<br>
据说导数一开始就是在求加速都时搞出来的。<br>
什么？你不知道什么是速度？不如先去学习一下：<a href="https://baike.baidu.com/item/%E9%80%9F%E5%BA%A6/5456#viewPageContent">传送门</a><br>
具体是怎么搞出来的没人知道 <del>(因为知道的人都挂了)</del> ，但这并不妨碍我们模拟一下当时的情况：<br>
在一个月黑风高的夜晚，牛顿思索着对于位移满足关系式：$s=t^2$的运动在$t=1$的速度 <del>牛顿：我怎么不知道？？？</del><br>
众所周知，$x-t$图像上某点切线的斜率即为该时刻的速度（什么？你不知道？刚不是叫你去学习了吗？）
令$s\rightarrow y$ , $t\rightarrow x$ , 作出它的图像和$x=1$时的切线：<br>
<img src="https://s1.ax1x.com/2020/07/18/U23nrq.png" alt=""><br>
看到了啥？只有一个交点有木有！！！这不就意味着联立后的方程只有一个根，那就用判别式就完了呗？<br>
是时候干点啥了。<br>
设切线方程为： $y=kx+b$ , 于是</p>
<p>$$
\begin{cases}
y &amp; = x^2 \\<br>
y &amp; = kx+b \<br>
\end{cases}
$$
又有$x=1,y=x^2=1$
$$
\Rightarrow
\begin{cases}
&amp;k+b=1 \\<br>
&amp;x^2-kx-b=0 \<br>
\end{cases}
$$
二次方程有木有！于是
$$\Delta=k^2-4(k-1)=0 \Rightarrow k=2$$
由此可以得出，$t=1$时，$v=2$</p>
<h1 id="一般化推广">一般化推广</h1>
<p>我们知道函数$y=x^2$在$x=1$的切线斜率是2,能不能让结论更加一般化呢?比如求其在$x=x_0$时的切线斜率?<br>
仿照上例:<br>
设切线方程为： $y=kx+b$
$$
\begin{cases}
y &amp; = x_0^2 \\<br>
y &amp; = kx_0+b 
\end{cases}
$$
咦？求不出来了？？？！ <strong>Σ(っ °Д °;)っ</strong><br>
<br>
有没有别的方法呢? <del>显然是有的,不然我就不会写这玩意了......</del></p>
<p>回顾刚才的过程，会发现切线的定义有问题。如图，这玩意也只有一个交点，但这明显不是我们想要的切线</p>
<p><img src="https://s1.ax1x.com/2020/07/19/UWljBt.png" alt="UWljBt.png"><br>
是时候重新定义一下切线了<br>
<br>
学过初中数学的都知道，两点确定一条直线，不如在函数上取两个点，不断缩小它们的距离，两点重合时，不就是切线了嘛！<br>
<br>
妙哉！说干就干：<br>
<br>
显然，已知两点$A(x_1,y_1),B(x_2,y_2)$,过这两点直线的斜率$k_{AB}={y_2-y_1 \over x_2-x_1}$,即：
$$k={\Delta y \over \Delta x}$$
设点$A,B$在$y=x^2$上,不妨设$A(x_0,x_0^2),B(x_0+ \Delta x , (x_0+ \Delta x)^2)$<br>
当$A,B$重合,即$\Delta x$极小时,$k$即为该点的斜率<br>
<br>
看不懂?上动图!<br>
<img src="https://s1.ax1x.com/2020/07/19/U22Jrq.gif" alt=""><br>
于是:<br>
$$k={\Delta y \over \Delta x}={(x_0+\Delta x)^2-x_0^2 \over \Delta x}={2x_0\Delta x+\Delta x^2\over \Delta x}=2x_0+\Delta x$$
$\Rightarrow$当$\Delta x\rightarrow 0$时,$k=2x_0$<br>
<br>
这是不是爽多了ヾ(•ω•`)o<br>
<br>
看到这里，小问号你是不是有很多朋友：导数是啥？跟这有关系吗？<br>
<br>
是时候走一手定义了：<br>
<br>
还在因为导数是什么而迷惑？导数就是函数的图像在某一点的切线斜率，即上文的k<br>
此外，数学家们觉得$\Delta$太难用，不仅难写 ~~（并不觉得）~~，还要不断给自己心理暗示这玩意无限趋近于0<br>
<br>
于是：</p>
<p>$$\Delta x\rightarrow dx , \Delta y \rightarrow dy $$<br>
$d$啥 就是啥的微小变化量<br>
<br>
还有，每一个$x$都对应着一个$k$，这明摆着$k$是$x$的函数嘛！又考虑到导数没有符号表示，$k$来$k$去的十分不爽，数学家们大笔一挥，在函数的右上角加了一撇，表示这个函数的导函数，即导数关于$x$的函数,如：<br>
<br>
$y'\rightarrow y$的导函数 $f'(x)\rightarrow f(x)$的导函数 甚至还可以这么玩：$(sin x)'$ 和 $[f(x)g(x)]'$ 以及 $(f(g(x)))'$<br>
<br>
这样一来爽多了：<br>
$$y'={dy\over dx}=2x$$
换成$f(x)$：<br>
$$f'(x)={df(x)\over dx}=2x$$</p>
<h1 id="导函数的性质">导函数的性质</h1>
<h2 id="复合函数的导函数">复合函数的导函数</h2>
<p>$(f(g(x))'$这二货咋求？<br>
常识告诉我们，最先出现的问题一定是用定义解决的：<br>
$$(f(g(x))'={df(g(x))\over dx}$$
然后呢？好问题...看我来一手骚操作:
$${df(g(x))\over dx}={df(g(x))\over dg(x)}·{dg(x)\over dx}=f'(x)g'(x)$$
这玩意可以约分，想不到吧，嘿嘿嘿（〃｀ 3′〃）<br>
<br>
由此得出:<strong>两函数复合，其导函数为两函数的导函数之积</strong></p>
<h2 id="函数之积的导函数">函数之积的导函数</h2>
<p>有了上面的经验，还是一手骚操作:
$$[f(x)g(x)]'={[f(x)+df(x)][g(x)+dg(x)]-f(x)g(x)\over dx}=f(x){dg(x) \over dx}+g(x){df(x) \over dx}$$
$$=f(x)g'(x)+f'(x)g(x)$$
咦？$df(x)dg(x)\over dx$哪去了？被我吃了吗？其实是它太小了。只要乘了个带$d$的，就不配拥有人权~ ╰(￣ω￣ｏ)</p>
<h2 id="函数之商的导函数">函数之商的导函数</h2>
<p>众所周知，大题的最后一问总是会用到前两问的结论，这个当然也不例外<br>
<br>
稍微变个型：
$$[{f(x)\over g(x)}]'=[f(x){1\over g(x)}]'$$
那不就是两函数之积的导函数嘛 ~(￣▽￣)~*<br>
至于这个$1\over g(x)$，不就是一个$u(x)={1\over x}$ 和 $g(x)$ 复合成 $u(g(x))$ 了嘛... (￣﹃￣)<br>
<br>
反手就是一顿操作：<br>
$$原式={f'(x)\over g(x)}-{f(x)g'(x)\over [g(x)]^2}={f'(x)g(x)-f(x)g'(x)\over [g(x)]^2}$$</p>
<h2 id="其他性质">其他性质</h2>
<p>$$[f(x)+g(x)]'=f'(x)+g'(x)$$
$$[af(x)]'=af'(x)$$
至于证明嘛，送你一首《西江月·证明》</p>
<center><b><font size=5>西江月·证明</font></b></center>
<b><font size=4>
<center>即得易见平凡，仿照上例显然，留作习题答案略，读者自证不难</center>
<center>反之亦然同理，推论自然成立，略去过程 Q E D ，由上可知证毕</center>
</font></b>
我就是懒得证，咬我呀 (～￣▽￣)～
<h1 id="一些常见函数的导函数">一些常见函数的导函数</h1>
<h2 id="常函数-c0">常函数 $C'=0$</h2>
<p>这有什么难的，横着一条直线的斜率不是0还能是啥？</p>
<h2 id="一次函数-kxk">一次函数 $(kx)'=k$</h2>
<p>一次函数嘛，它的切线就是它自己，导数即斜率，斜率即$k$</p>
<h2 id="幂函数-fxxnrightarrow-fxnxn-1">幂函数: $f(x)=x^n\Rightarrow f'(x)=nx^{n-1}$</h2>
<p>在这里我们直接上通用方法,需要使用<a href="https://baike.baidu.com/item/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%AE%9A%E7%90%86">二项式定理</a>:<br>
$$f'(x)={df(x) \over dx}={(x+dx)^n-x^n \over dx}={\tbinom{1}{n}x^{n-1}dx+\tbinom{2}{n}x^{n-2}dx^2+...+dx^n \over dx}$$
$$=\tbinom{1}{n}x^{n-1}+\tbinom{2}{n}x^{n-2}dx+...+dx^{n-1}=nx^{n-1}$$</p>
<h2 id="三角函数sin-xcos-x--cos-x-sin-x">三角函数:$(sin x)'=cos x$ , $(cos x)'=-sin x$</h2>
<p>这个需要用到一点<a href="https://baike.baidu.com/item/%E5%92%8C%E5%B7%AE%E5%8C%96%E7%A7%AF">和差化积</a>的姿势
$$(sin x)'={sin(x+dx)-sin x \over dx}={2cos(x+{dx\over 2}) sin {dx \over 2}\over dx}$$
又有:
$$\lim\limits_{x\rightarrow 0}\sin x=x$$
$$\Rightarrow (sin x)'=cos x$$
$cos x$同理，其实是我懒得打了(￣y▽,￣)╭</p>
<h2 id="指数函数-axaxlna">指数函数: $(a^x)'=a^xlna$</h2>
<p>据说数学家们经大量计算发现，这玩意的导函数就是一个常数乘以它自己，而且这个常数还会变！<br>
于是他们怒了，设了一个常数$e$使得$(e^x)'=e^x$ 没错这就是$e$的由来 ¯\_ (ツ)_/¯<br>
于是：
$$e^{ln x}=x \Rightarrow (e^{ln x})'=1$$
由复合函数求导的姿势：<br>
$$ (e^{ln x})'=e^{ln x}(ln x)'$$
$$\Rightarrow (xln x)'=1 \Rightarrow (ln x)'={1\over x}$$
于是我们就可以把指数给他拉下来了：<br>
$$ln(a^x)=xln(a) \Rightarrow [ln(a^x)]'=[xln(a)]'=lna$$
又有(复合函数求导)：
$$[ln(a^x)]'={1\over a^x}·(a^x)'$$
$$\Rightarrow (a^x)'=a^xlna$$</p>
<h2 id="对数函数log_ax1over-xlna">对数函数:$(log_a{x})'={1\over xlna}$</h2>
<p>这里来一手换底公式就变成了函数之商求导，over：
$$(log_a{x})'=({lnx\over lna})'={1\over xlna}$$</p>
<h1 id="导数的应用">导数的应用</h1>
<p>看了这么久，小问号的朋友一定越来越多了，这有啥用呢？<br>
<br>
其实，导数最大的用处就是求函数的单调性和最值，最大值和最小值都能搞定<br>
<br>
显然，增函数的导数大于0，减函数的导数小于0，导数的绝对值越大，函数值变化得就越快<br>
为啥？导数是斜率啊~
换句话说，函数单调递增时其导数大于0，单调递减时导数小于0<br>
那导数等于0时呢？那就是被夹在增区间和减区间的交界处了呗，不是最大值就是最小值( ﹁ ﹁ ) ~→<br>
<br>
来，直观感受一下<br>
<img src="https://s1.ax1x.com/2020/07/19/UWdUeg.png" alt="UWdUeg.png"><br>
那么求函数增区间的问题就变成了解 导数&gt;0 的不等式<br>
求函数最值就变成了解 导数=0 的方程<br>
<br>
岂不是美滋滋ヾ(≧▽≦*)o<br>
<br>
例：讨论函数$f(x)={1\over 2}x^3-{3\over 2}x$的单调性<br>
$$f'(x)={3\over 2}x^2-{3\over 2}={3\over 2}(x+1)(x-1)$$
$$\therefore x\in (-\infty ,-1)\cup (1,+\infty)时，f'(x)&gt;0,x\in (-1,1)时f'(x)&lt;0$$
$$\therefore f(x)在(-\infty,-1)和(1,+\infty)上单调递增，在(-1,1)上单调递减$$<br>
<br>
完结撒花 ✿✿ヽ(°▽°)ノ✿</p>
]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/%E6%95%B0%E5%AD%A6/">数学</category>
                                    
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/%E5%BE%AE%E7%A7%AF%E5%88%86/">微积分</category>
                                    
                                
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>积分</title>
                    <link>http://example.com/posts/%E7%A7%AF%E5%88%86/</link>
                    <guid isPermaLink="true">http://example.com/posts/%E7%A7%AF%E5%88%86/</guid>
                    <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
                    <description><![CDATA[<h1 id="引子">引子</h1>
<p>数学家们在解决了导数这一迷之问题后，造就了迷之脑洞，想出了一些迷之问题<br>
<br>
比如这个:求函数$y=x^2$的图像和$x$轴以及直线$x=1$围成的面积<br>
<img src="https://s1.ax1x.com/2020/07/20/U4jDA0.png" alt="图我都给你准备好了">
有了导数的经验,数学家们一拍光秃秃的脑袋:&quot;不如我们再玩一次$\Delta$吧?&quot;<br>
<br>
于是他们把$0\rightarrow 1$分成了$n$份,画出了$n$个矩形,就像这样<br>
<img src="https://s1.ax1x.com/2020/07/20/U4j07q.png" alt="U4j07q.png"><br>
其中每个矩形的底都是$1\over n$,高就是右端点横坐标的平方,即$x^2$,是第几个矩形,$x$就等于几倍$1\over n$<br>
<br>
这样一来，矩形的面积之和:<br>
$$
\begin{aligned}
S &amp;= {1\over n}\cdot \left(1\over n\right)^2 + {1\over n}\cdot \left(2\over n\right)^2+{1\over n}\cdot \left(3\over n\right)^2+...+{1\over n}\cdot \left(n\over n\right)^2 \<br>
&amp;= {1\over n}\cdot \left( \left( 1\over n\right)^2+\left( 2\over n\right)^2+\left( 3\over n\right)^2+...+\left( n\over n\right)^2\right) \<br>
&amp;= {1\over n^3}\cdot \left(1^2+2^2+3^2+...+n^2\right)\<br>
&amp;= {1\over n^3}\cdot {n(n+1)(2n+1)\over 6}\<br>
&amp;= {1\over 3}+{1\over 3n}+{1\over 6n^2}
\end{aligned}
$$
然后，让$n\rightarrow +\infty$矩形的面积和就是所求面积，故：
$$S={1\over 3}$$
数学家们老高兴了呢~</p>
<h1 id="一般化推广">一般化推广</h1>
<p>在解决了上面的问题后，数学家们本着永无止境的心，又把1换成了$x_0$,让我们一起康康有什么变化：<br>
还是一样地把0~$x_0$分成$n$份，仿照上面画出$n$个矩形：<br>
$$
\begin{aligned}
S &amp;= {x_0\over n}\cdot \left(x_0\over n\right)^2 + {x_0\over n}\cdot \left(2x_0\over n\right)^2+{x_0\over n}\cdot \left(3x_0\over n\right)^2+...+{x_0\over n}\cdot \left(nx_0\over n\right)^2 \\<br>
&amp;= {x_0\over n}\cdot \left( \left( x_0\over n\right)^2+\left( 2x_0\over n\right)^2+\left( 3x_0\over n\right)^2+...+\left( nx_0\over n\right)^2\right) \\<br>
&amp;= {x_0^3\over n^3}\cdot \left(1^2+2^2+3^2+...+n^2\right)\\<br>
&amp;= {x_0^3\over n^3}\cdot {n(n+1)(2n+1)\over 6}\\<br>
&amp;= {x_0^3\over 3}+{x_0^3\over 3n}+{x_0^3\over 6n^2}
\end{aligned}
$$
接着，让$n\rightarrow +\infty$，那么:
$$S={1\over 3}x_0^3$$</p>
<p>回顾上面的过程，本着偷懒的精神，数学家们开始简化算式：<br>
老是$1\over n$的太烦，还要说明$n\rightarrow  +\infty$,不如直接用导数里现成的$dx$代替$1\over n$多省事ψ(｀∇´)ψ<br>
省略号太烦，还要列举前几项，$dx$又无限小，不能用求和符号，于是他们把求和符号拉长，创造了个新玩意：<br>
$$\sum_{i=1}^n {1\over n}\cdot{i\over n}^2\rightarrow \int_0^1 x^2dx$$
看到这个，小问号的朋友又多了起来：woc这都是什么鬼东西(⊙_⊙)？<br>
<br>
$dx$就是$x$的一个微小变化量，我们以这个玩意作为矩形的底，画出$\infty$个矩形<br>
那矩形的高怎么办呢？嘿嘿嘿，反正矩形的端点(反正底无限小，左右无所谓)的横坐标是$x$，我们直接拿$x^2$当高岂不是美滋滋（￣︶￣）↗<br>
于是乎，一个矩形的面积就是底乘高，即<br>
$$x^2 dx$$
把0~1的所有矩形的面积加起来，就表示成：
$$\int_0^1x^2dx={1\over 3}$$
数学家们管这叫定积分 ,即有范围的积分，算出来是一个数，表示这个范围里函数图像围成的面积<br>
<br>
有 定 就一定有不定，即没有范围的积分，算出来是一个函数，表示从0开始函数图像围成的面积随$x$变化的关系:<br>
$$\int x^2dx={1\over 3}x^3$$</p>
<h1 id="积分的性质">积分的性质</h1>
<p>不知道你发现没有 <del>反正我是没有</del> ：
$$\int x^2dx={1\over 3}x^3$$
$$({1\over 3}x^3)'=x^2$$
不定积分和导数一定有什么不可告人的秘密 ( •̀ ω •́ )✧
<br>
假设我们有一个函数$f(x)%$：
$$f'(x)={df(x)\over dx }\Rightarrow f'(x)dx=df(x)$$
那么：
$$\int f'(x)dx=\int df(x)=f(x)$$
至于你问为什么：
$$\int df(x)=f(x)$$
因为$df(x)=f(x+dx)-f(x)$,学过数列的小盆友一看就知道，这不就是一手裂项相消嘛~<br>
<br>
至此，我们发现了，求导和不定积分互为 <strong>逆运算</strong> ！！！<br>
<br>
这样一来爽啦，什么积分不会搞，找找什么东西求导等于它就成啦！这样，数学家们搞出了一堆积分公式：
$$\int kdx=kx+C$$
$$\int x^n={1\over n+1}x^{n+1}+C$$
$$\int {1\over x}=\ln x+C$$
$$\int \sin x dx=-\cos x +C$$
$$\int \cos x dx=\sin x +C$$
$$...$$
咦，这一堆$C$是干什么吃的？
<br>
在积分式中：
$$\int f(x)dx=F(x)+C$$
我们称$F(x)$为$f(x)$的一个原函数，就是$f(x)$求导之前原来的那个函数<br>
一个函数的原函数有无数个，因为求导后函数的常数部分直接就莫得了，所以积分时要把它加回去<br>
不信？看好喽：
$$2=(2x)'=(2x+1)'=(2x+2)'=...$$
这真是要多少有多少 `(<em>&gt;﹏&lt;</em>)′&gt;)</p>
<p>秉承着偷懒至上的伟大精神，数学家们把这一堆常数合并成一个$C$，称其为“积分常数”<br>
真可谓 “大道至简，务实高效” 啊 <del>没错，这就是我们前班主任的格言</del><br>
<br>
此外，积分和导数一样，有如下性质：
$$\int [f(x)+g(x)]=\int f(x)+\int g(x)$$
$$\int [af(x)]=a\int f(x)$$
毕竟互为逆运算嘛，都是一家人¯\ (°_o)/¯</p>
<h1 id="积分的运算">积分的运算</h1>
<p>搞了这么久，你一定很想知道定积分怎么算吧？<br>
来，搬张板凳，继续吃瓜  ——<strong>牛顿——莱布尼茨公式</strong> “</p>
<blockquote>
<p>如果函数$f(x)$在区间$[a,b]$上连续，并且存在原函数$F(x)$ ,<br>
则：
$$\int_a^bf(x)dx=F(b)-F(a)=F(x)|_a^b$$</p>
</blockquote>
<p>咦为什么没加$C$？因为$F(a)$和$F(b)$都加了$C$，一减就莫得了(｡･∀･)ﾉﾞ<br>
至于你问$F(x)|_a^b$是个什么意思，那就是$F(b)-F(a)$，目的就是少写几个字 (＃°Д°)<br>
证明嘛。。。<a href="https://baike.baidu.com/item/%E7%89%9B%E9%A1%BF-%E8%8E%B1%E5%B8%83%E5%B0%BC%E8%8C%A8%E5%85%AC%E5%BC%8F/7451942?fr=aladdin">围观大佬</a>就好，切记，保护好头发ヾ(•ω•`)o<br>
<br>
看到这里，你以为你就会算积分了吗？no no no，比如这个：(大佬请绕路)
$$\int {1\over x+1}dx = ?$$
这就需要 <strong>换元积分法</strong> 了<br>
<br> 
令$t=x+1$,则：
$$\int {1\over x+1}dx=\int {1\over t}dx$$
又有：
$$t'=(x+1)'=x'\Rightarrow dt=dx$$
$$原式=\int {1\over t}dt=\ln t +C=\ln(x+1)+C$$
是不是很秀？<br>
<br>
尽管还有一些东西暂时积不出来，就先到这儿吧 <del>因为我还不会</del>，到时候再补，咬我呀~</p>
<h1 id="积分的应用">积分的应用</h1>
<p>有了积分，我们就可以为所欲为地算一些奇奇怪怪的东西了<br>
<br>
比如算球的体积<br>
<br>
众所周知，球是由一个圆旋转得来的，我们取出那个圆，其半径为$r$，放到坐标系里，其方程就是：
$$x^2+y^2=r^2$$
因为一个半圆沿直径旋转就可以搞出一个球了，这里偷个懒，把它变成半圆：
$$y=\sqrt{r^2-x^2}$$
秉承着偷懒的伟大精神，${1\over 4}$圆沿半径旋转一圈是半球，算出这玩意的体积再乘个2就行了<br>
<img src="https://s1.ax1x.com/2020/07/21/UIUYsx.png" alt="UIUYsx.png">
还是一样在里面画个长为$dx$矩形：<br>
<img src="https://s1.ax1x.com/2020/07/21/UIa961.png" alt="UIa961.png">
它的高就是$\sqrt{r^2-x^2}$<br>
<br>
这个小矩形沿$x$轴旋转一圈就是一个圆柱,这个圆柱的底面半径就是这个矩形的高，高就是这个矩形的底边长<br>
其体积为：
$$\pi\cdot(\sqrt{r^2-x^2})^2dx=\pi r^2dx-\pi x^2dx$$
那把0~1这无数个小圆柱的体积加起来不就是这个半球的体积了？故：
$$
\begin{aligned}
V &amp;= \int _0^r (\pi r^2-\pi x^2)dx\<br>
&amp;=(\pi r^2 x-{\pi \over 3}x^3)|_0^r\<br>
&amp;={2\over 3}\pi r^3
\end{aligned}
$$
那么球的体积就是这个半球体积的两倍：
$$V_球={4\over 3}\pi r^3$$
妙啊(*￣3￣)╭<br>
<br>
不仅如此，还可以算其他奇奇怪怪的东西，比如球的表面积、$y=x^2$沿$y$轴转一圈的体积等等...<br>
总之，干旋转体这活特别在行<br>
<br>
完结撒花 ✿✿ヽ(°▽°)ノ✿</p>
]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/%E6%95%B0%E5%AD%A6/">数学</category>
                                    
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/%E5%BE%AE%E7%A7%AF%E5%88%86/">微积分</category>
                                    
                                
                            
                        
                    
                </item>
            
        
            
                <item>
                    <title>线段树</title>
                    <link>http://example.com/posts/%E7%BA%BF%E6%AE%B5%E6%A0%91/</link>
                    <guid isPermaLink="true">http://example.com/posts/%E7%BA%BF%E6%AE%B5%E6%A0%91/</guid>
                    <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
                    <description><![CDATA[<h1 id="简介">简介</h1>
<p>对于RMQ问题，暴力计算时间复杂度踏大了，所以要预处理<br>
预处理全部子区间空间复杂度踏大了，预处理的时间复杂度踏大了，还贼难修改<br>
如果能预处理一部分子区间，正好对上查询区间最好，对不上也能用预处理过的区间“拼凑”出查询区间，时间空间复杂度还小就完美了<br>
区间怎么选呢？当然是二分啦 <del>多么优秀的想法</del></p>
<p>线段树是一种数据结构，用来解决RMQ(区间最值)问题 <del>当然拓展一下也可以有别的用法</del><br>
顾名思义，线段树是一棵二叉树 ，所谓线段，特别之处是线段树上的每个结点代表一个区间<br>
其查询和修改的时间复杂度为Olog(n)</p>
<h2 id="工作原理">工作原理</h2>
<p>对于一棵线段树来说，每个节点有两个子节点，每个节点的区间长度都是其父节点的一半，并提前预处理好了每个节点代表区间的待查询数据。这样在查询和修改时，就可以分为三类：</p>
<ol>
<li>在区间的左半边</li>
<li>在区间的右半边</li>
<li>在左半边和右半边都有分布</li>
</ol>
<p>这样在查询和修改时就可以按这三种情况进行操作，直到找到的区间</p>
<ol>
<li>在<br>
就像在欧亚大陆上找一个地方，可以分为三种情况：</li>
<li>全部在欧洲，如英国</li>
<li>全部在亚洲，如中国</li>
<li>横跨欧亚大陆，如俄罗斯</li>
</ol>
<p>这样在查询的时候，每次将查询的区间缩小一半，复杂度就达到了$log(n)$级别</p>
<h1 id="基础">基础</h1>
<h2 id="查询">查询</h2>
<p>比如有一段序列：<strong>1 , 3 , 5 , 2 ，2</strong><br>
建立的线段树(每个结点保存其区间的<strong>最大值</strong>)如下 <del>暂且先不管它是怎么建立的</del><br>
<img src="https://s1.ax1x.com/2020/04/26/J6j7rt.png" alt=""></p>
<h4 id="观察这棵树可以发现有这两个特点">观察这棵树，可以发现有这两个特点</h4>
<ul>
<li><strong><font color=green>叶结点</font></strong> 区间长度为1，代表这段序列中的一个个数字</li>
<li><strong><font color=blue>其它结点</font></strong> 的的区间是其两个子节点区间的并集</li>
</ul>
<h4 id="查询方法">查询方法</h4>
<ul>
<li>待查询区间位于左子节点，向左子节点递归查询，并返回结果</li>
<li>待查询区间位于右子节点，向右子节点递归查询，并返回结果</li>
<li>待查询区间分布于两个子节点，拆分区间使其包含于被两个子节点的区间，向两个子节点递归查询，比较，并返回结果</li>
</ul>
<h4 id="模拟一下查询的过程查询区间-24-的最大值">模拟一下查询的过程(查询区间 <strong>[2,4]</strong> 的最大值)</h4>
<ol>
<li>访问根节点，其区间为[0,4]，不是待查询区间，且待查询区间分布于其两个子节点</li>
<li>将待查询区间分为[2,2]和[3,4]向左子节点查询[2,2]</li>
<li>左子节点:其区间为[0,2]，不是待查询区间，待查询区间位于其右子节点</li>
<li>访问左子节点的右子节点，其区间为[2,2]，是待查询区间，返回结果：5</li>
<li>左子节点返回结果：5</li>
<li>向右子节点查询区间[3,4]</li>
<li>右子节点:其区间为[3,4]，是待查询区间，返回结果：2</li>
<li>比较两子节点返回值：5&gt;2，查返回询结果：5</li>
</ol>
<h4 id="可以由此写出查询代码最大值">可以由此写出查询代码(最大值)</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">double</span> <span style="color:#75af00">finda</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树.查询左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span><span style="color:#75715e">//从中间切开,递归分别查询,返回最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="修改">修改</h2>
<h3 id="单点修改">单点修改</h3>
<p>顾名思义，单点修改就是修改序列中的一个数<br>
还是这段序列和这棵线段树<br>
<img src="https://s1.ax1x.com/2020/04/26/J6j7rt.png" alt=""></p>
<h4 id="修改方法">修改方法</h4>
<ol>
<li>找到待修改的叶结点</li>
<li>修改叶结点的值</li>
<li>更新其父节点的值</li>
</ol>
<h4 id="模拟一下单点修改的过程将11这个数修改为9">模拟一下单点修改的过程(将[1,1]这个数修改为9)</h4>
<ol>
<li>访问根节点，待修改节点位于其左子树</li>
<li>访问其左子节点，待修改节点位于其左子树</li>
<li>访问其左子节点，待修改节点是其右子节点</li>
<li>访问其右子节点，修改其值为9</li>
<li>返回其父节点，9&gt;1，更新其值为9</li>
<li>返回其父节点，9&gt;5，更新其值为9</li>
<li>返回其父节点，9&gt;2，更新其值为9</li>
<li>到达根节点，修改结束</li>
</ol>
<h4 id="由此可以写出单点修改代码最大值">由此可以写出单点修改代码(最大值)</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">change</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">v</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
    <span style="color:#00a8c8">if</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#f92672">==</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#f92672">==</span><span style="color:#111">s</span><span style="color:#111">)</span> <span style="color:#75715e">//找到待修改节点，修改
</span><span style="color:#75715e"></span>    <span style="color:#111">{</span>
        <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">v</span><span style="color:#f92672">=</span><span style="color:#111">v</span><span style="color:#111">;</span>
        <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">s</span><span style="color:#111">)</span> 
    <span style="color:#111">{</span>
        <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">v</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树.查询左子树
</span><span style="color:#75715e"></span>        <span style="color:#111">update</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新该节点的值
</span><span style="color:#75715e"></span>        <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">s</span><span style="color:#111">)</span> 
    <span style="color:#111">{</span>
        <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">v</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>        <span style="color:#111">update</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新该节点的值
</span><span style="color:#75715e"></span>        <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="区间修改">区间修改</h3>
<p>顾名思义，区间修改就是对指定的区间进行 + - * / 操作</p>
<h4 id="思路">思路</h4>
<p>一种想法是对区间中的每个数进行单点修改操作，然而这样做复杂度是Onlog(n)，太大，不可取<br>
上文提到线段树的区间修改可以做到Olog(n)的复杂度，这是怎么实现的呢？<br>
回顾简单思路的问题：不难发现，这样把线段树全部相关节点都修改了，然而有些节点可能不会被使用到<br>
举个栗子：如果按照这种思路将[0,4]全部+1,而后查询区间却没有包含[0,2]，那么[0,2]这个子树就等于白修改了<br>
不难想到解决方法：标记相关子树的根结点，表示这棵子树上的全部结点的值都被修改，使用时再把标记传递给子节点就好了</p>
<h4 id="修改方法-1">修改方法</h4>
<ul>
<li>待查询区间就是此区间，打上标记，返回</li>
<li>待查询区间位于左子节点，向左子节点递归修改，更新</li>
<li>待查询区间位于右子节点，向右子节点递归修改，更新</li>
<li>待查询区间分布于两个子节点，拆分区间使其包含于被两个子节点的区间，向两个子节点递归修改，更新</li>
</ul>
<h4 id="后续查询方法">后续查询方法</h4>
<ul>
<li>待查询区间位于左子节点，把标记传递给左子节点并向其递归查询，并返回结果</li>
<li>待查询区间位于右子节点，把标记传递给右子节点并向其递归查询，并返回结果</li>
<li>待查询区间分布于两个子节点，拆分区间使其包含于被两个子节点的区间，把标记传递给两个子节点并向其递归查询，比较，并返回结果</li>
</ul>
<h4 id="模拟一下修改的过程将03区间的数全部1">模拟一下修改的过程(将[0,3]区间的数全部+1)</h4>
<p><img src="https://s1.ax1x.com/2020/04/26/J6j7rt.png" alt=""></p>
<ol>
<li>访问根节点，不是待修改区间，拆分待修改区间为[0,2]和[3,3]</li>
<li>向左子树查询，是待修改区间，修改标记为1，更新值为6，返回
<img src="https://s1.ax1x.com/2020/04/26/JcZtqU.png" alt=""></li>
<li>向右子树查询，不是待修改区间，待修改区间位于其左子树</li>
<li>向其左子树查询，是待修改区间，且是叶结点，直接修改，返回
<img src="https://s1.ax1x.com/2020/04/26/JcZRde.png" alt=""></li>
<li>3&gt;2，更新值为3，返回
<img src="https://s1.ax1x.com/2020/04/26/Jceuy6.png" alt=""></li>
<li>6&gt;3，更新值为6，结束
<img src="https://s1.ax1x.com/2020/04/26/Jce00S.png" alt=""></li>
</ol>
<h4 id="再模拟一下查询的过程查询23的最大值">再模拟一下查询的过程(查询[2,3]的最大值)</h4>
<ol>
<li>访问根节点，不是待查询区间，拆分其为[2,2]和[3,3]</li>
<li>向左子树查询，不是待查询区间，进一步查询前把标记传递给两个子节点并更新它们的值
<img src="https://s1.ax1x.com/2020/04/26/JcmP1I.png" alt=""></li>
<li>待查询区间位于其右子树，向右子树查询</li>
<li>待查询区间是此区间，返回结果：6</li>
<li>返回结果：6</li>
<li>向右子树查询(此处省略查询步骤)，返回结果：3</li>
<li>6&gt;3，返回查询结果：6</li>
</ol>
<h4 id="由此可以写出修改代码">由此可以写出修改代码</h4>
<p>更新</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">);</span><span style="color:#75715e">//更新最大值
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>传递标记</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span><span style="color:#75715e">//若没有标记,传递啥?
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子结点,无需修改其标记(根本就没标记...)
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">else</span><span style="color:#75715e">//否则,先修改标记,再修改值
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//同上(本来就是复制下来的...)
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">else</span>
	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//删除加法标记
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>区间加法</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">_add</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间完全重合
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//若不是叶子结点,更新加法标记
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间最小值
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间最大值
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若区间完全位于其左子树,向左子树查找区间l~r并执行加法
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">else</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若区间完全位于其右子树,向右子树查找区间l~r并执行加法
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span><span style="color:#75715e">//从中间切开,分别执行加法
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
			<span style="color:#111">}</span>
	<span style="color:#111">}</span>
	<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><p>查询最大值</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">double</span> <span style="color:#75af00">finda</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树.查询左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span><span style="color:#75715e">//从中间切开,分别查询,返回最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="构建线段树">构建线段树</h3>
<p>其实跟建立普通二叉树一样，只不过多了初始化区间和值以及更新的操作，递归建树即可</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#75af00">_build</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">t</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">node</span><span style="color:#111">;</span><span style="color:#75715e">//建立新节点
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#111">l</span><span style="color:#111">;</span><span style="color:#75715e">//区间左端点
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">;</span><span style="color:#75715e">//区右端点
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">father</span> <span style="color:#f92672">=</span> <span style="color:#111">t</span><span style="color:#111">;</span><span style="color:#75715e">//建立父子关系
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">==</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//若t没有左子树,说明要构建的树为其左子树
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">else</span> <span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//反之,则为右子树
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子节点
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span><span style="color:#75715e">//三个一样
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//返回节点地址
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">=</span><span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">);</span><span style="color:#75715e">//构造左子树
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">=</span><span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//构造右子树
</span><span style="color:#75715e"></span>	<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="进阶">进阶</h1>
<h3 id="区间和">区间和</h3>
<p>线段树除了可以维护最值，还可以维护区间和</p>
<h4 id="方法">方法</h4>
<p>其实也很简单，每一个结点的值就是其子节点的值之和，单点修改只需减掉原来的在加上修改后的就行了，区间加法只需加上<strong>加数×区间长度</strong>即可</p>
<h4 id="查询区间和代码">查询区间和代码</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">double</span> <span style="color:#75af00">findu</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回区间和
</span><span style="color:#75715e"></span>	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//若待查询区间位于其左子树,查询左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//若待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//从中间切开,分别查询,返回和
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="更新代码">更新代码</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">);</span><span style="color:#75715e">//更新最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">);</span><span style="color:#75715e">//更新最小值
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="区间乘法">区间乘法</h3>
<p>线段树除了可以进行区间加法，还可以进行区间乘法</p>
<h4 id="方法-1">方法</h4>
<ul>
<li>进行区间乘法时，最大值，最小值 都只需乘上乘数即可，然后再修改乘法标记。</li>
<li>此处注意，传递标记时要在修改子节点乘法标记的同时将加法标记乘以乘数，然后加上父节点的加法标记，即<strong>先乘后加</strong>原则</li>
</ul>
<h4 id="传递标记代码">传递标记代码</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span><span style="color:#75715e">//若没有标记,传递啥?
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子结点,无需修改其标记(根本就没标记...)
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//先乘后加
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">else</span><span style="color:#75715e">//否则,先修改标记,再修改值
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//先乘后加
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span><span style="color:#75715e">//区间和增加传递的标记乘以区间节点个数
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//同上(本来就是复制下来的...)
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">else</span>
	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//删除加法标记
</span><span style="color:#75715e"></span>	<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span><span style="color:#75715e">//删除乘法标记
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="区间乘法代码">区间乘法代码</h4>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#00a8c8">void</span> <span style="color:#75af00">_multiply</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间完全重合
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//若不是叶子结点,更新乘法标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">k</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span><span style="color:#75715e">//若乘数为正
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最大的还是最大的
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最小的还是最小的
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">double</span> <span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">;</span><span style="color:#75715e">//暂时储存
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最大的符号相反后变成最小的
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最小的符号相反后变为最大的
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新加法标记(下面每个数要加的数也乘了k)
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子节点前先更新标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若待操作区间完全位于左子树,向左子树查询并进行区间乘法
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">else</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若待操作区间完全位于右子树,向右子树查询并进行区间乘法
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span><span style="color:#75715e">//从中间切开,分别进行操作
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
			<span style="color:#111">}</span>
	<span style="color:#111">}</span>
	<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span><span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="完整代码">完整代码</h1>
<h2 id="指针版理解下蒟蒻的思路">指针版(理解下蒟蒻的思路)</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">288
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">289
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">290
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">291
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">292
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">293
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">294
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">295
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">296
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">297
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">298
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">299
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">300
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">301
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">302
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">303
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">304
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">305
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">306
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">307
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">308
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">309
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">310
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">311
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">312
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">313
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">314
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">315
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">316
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">317
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">318
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">319
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">320
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">321
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">322
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">323
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">324
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">325
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">326
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">327
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">328
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">329
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">330
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">331
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">332
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">333
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">334
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">335
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">336
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">337
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">338
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">339
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">340
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">341
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">342
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">343
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">344
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">345
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">346
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">347
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">348
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">349
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">350
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">351
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">352
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">353
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">354
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;algorithm&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#00a8c8">using</span> <span style="color:#00a8c8">namespace</span> <span style="color:#111">std</span><span style="color:#111">;</span>
<span style="color:#75715e">#define inf 0x3f3f3f3f
</span><span style="color:#75715e"></span><span style="color:#00a8c8">class</span> <span style="color:#75af00">tree</span>
<span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
	<span style="color:#00a8c8">struct</span> <span style="color:#75af00">node</span>
	<span style="color:#111">{</span>
		<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">father</span><span style="color:#111">;</span><span style="color:#75715e">//父节点
</span><span style="color:#75715e"></span>		<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">left</span><span style="color:#111">;</span><span style="color:#75715e">//左子树
</span><span style="color:#75715e"></span>		<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">right</span><span style="color:#111">;</span><span style="color:#75715e">//右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">max</span><span style="color:#111">;</span><span style="color:#75715e">//区间最大值
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">min</span><span style="color:#111">;</span><span style="color:#75715e">//区间最小值
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//区间和
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span><span style="color:#75715e">//区间端点
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">lazy_add</span><span style="color:#111">;</span><span style="color:#75715e">//加法标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">double</span> <span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//乘法标记
</span><span style="color:#75715e"></span>		<span style="color:#111">node</span><span style="color:#111">()</span><span style="color:#75715e">//初始化
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">father</span> <span style="color:#f92672">=</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>
			<span style="color:#111">left</span> <span style="color:#f92672">=</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>
			<span style="color:#111">right</span> <span style="color:#f92672">=</span> <span style="color:#111">NULL</span><span style="color:#111">;</span>
			<span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">;</span>
			<span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">;</span>
			<span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//即什么都没加
</span><span style="color:#75715e"></span>			<span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span><span style="color:#75715e">//即什么都没乘
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
	<span style="color:#111">};</span>
	<span style="color:#f92672">~</span><span style="color:#111">tree</span><span style="color:#111">()</span><span style="color:#75715e">//删除整棵树
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">d_t</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//---------------------------------------------构造线段树--------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">build</span><span style="color:#111">(</span><span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span> <span style="color:#111">num</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">d_t</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">);</span><span style="color:#75715e">//删除旧树
</span><span style="color:#75715e"></span>		<span style="color:#111">nums</span> <span style="color:#f92672">=</span> <span style="color:#111">num</span><span style="color:#111">;</span><span style="color:#75715e">//赋新值
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">size</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">.</span><span style="color:#111">size</span><span style="color:#111">()</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">size</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#111">root</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">node</span><span style="color:#111">;</span>
		<span style="color:#111">root</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//根节点区间左端为0
</span><span style="color:#75715e"></span>		<span style="color:#111">root</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#111">size</span><span style="color:#111">;</span><span style="color:#75715e">//根节点区间右端为size
</span><span style="color:#75715e"></span>		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">);</span><span style="color:#75715e">//构建左子树
</span><span style="color:#75715e"></span>		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">size</span><span style="color:#111">);</span><span style="color:#75715e">//构建右子树
</span><span style="color:#75715e"></span>		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">);</span><span style="color:#75715e">//更新根节点的值
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//-----------------------------------------------查询-----------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">double</span> <span style="color:#75af00">find</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">string</span> <span style="color:#111">mode</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;max&#34;</span><span style="color:#111">)</span><span style="color:#75715e">//返回区间最大值
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;min&#34;</span><span style="color:#111">)</span><span style="color:#75715e">//返回区间最小值
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;sum&#34;</span><span style="color:#111">)</span><span style="color:#75715e">//返回区间和
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------区间加法--------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">add</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span><span style="color:#75715e">//区间l~r内每个数加k
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------区间减法--------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">multiply</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span><span style="color:#75715e">//区间l~r内.每个数乘k
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//--------------------------------------------输出整个区间-------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">out</span><span style="color:#111">()</span><span style="color:#75715e">//输出线段树包含的数
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">_out</span><span style="color:#111">(</span><span style="color:#111">root</span><span style="color:#111">);</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
<span style="color:#00a8c8">private</span><span style="color:#f92672">:</span>
	<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">root</span><span style="color:#111">;</span><span style="color:#75715e">//根节点
</span><span style="color:#75715e"></span>	<span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span><span style="color:#111">nums</span><span style="color:#111">;</span><span style="color:#75715e">//数据
</span><span style="color:#75715e"></span>	<span style="color:#75715e">//----------------------------------------------删除------------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">d_t</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span> <span style="color:#f92672">==</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span><span style="color:#75715e">//啥毛没有,咋删?
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">!=</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#111">d_t</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">);</span><span style="color:#75715e">//删除左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span> <span style="color:#f92672">!=</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#111">d_t</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">);</span><span style="color:#75715e">//删除右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">delete</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//删除自己
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------更新--------------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">);</span><span style="color:#75715e">//更新最大值
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">);</span><span style="color:#75715e">//更新最小值
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------构造---------------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#75af00">_build</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">t</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">new</span> <span style="color:#111">node</span><span style="color:#111">;</span><span style="color:#75715e">//建立新节点
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#111">l</span><span style="color:#111">;</span><span style="color:#75715e">//区间左端点
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">;</span><span style="color:#75715e">//区右端点
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">father</span> <span style="color:#f92672">=</span> <span style="color:#111">t</span><span style="color:#111">;</span><span style="color:#75715e">//建立父子关系
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">==</span> <span style="color:#111">NULL</span><span style="color:#111">)</span> <span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//若t没有左子树,说明要构建的树为其左子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">else</span> <span style="color:#111">t</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//反之,则为右子树
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子节点
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span><span style="color:#75715e">//三个一样
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#111">;</span><span style="color:#75715e">//返回节点地址
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">=</span><span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">);</span><span style="color:#75715e">//构造左子树
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">=</span><span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//构造右子树
</span><span style="color:#75715e"></span>		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#75715e">//---------------------------------------------传递标记---------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span><span style="color:#75715e">//若没有标记,传递啥?
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子结点,无需修改其标记(根本就没标记...)
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//先乘后加
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span><span style="color:#75715e">//否则,先修改标记,再修改值
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span><span style="color:#75715e">//先乘后加
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span><span style="color:#75715e">//区间和增加传递的标记乘以区间节点个数
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//同上(本来就是复制下来的...)
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span>
		<span style="color:#111">{</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span><span style="color:#75715e">//删除加法标记
</span><span style="color:#75715e"></span>		<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span><span style="color:#75715e">//删除乘法标记
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//------------------------------------------------输出----------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_out</span><span style="color:#111">(</span><span style="color:#111">node</span><span style="color:#f92672">*</span> <span style="color:#111">p</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若为叶子节点,输出
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; &#34;</span><span style="color:#111">;</span>
			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#111">_out</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">);</span><span style="color:#75715e">//输出左子树
</span><span style="color:#75715e"></span>		<span style="color:#111">_out</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">);</span><span style="color:#75715e">//输出右子树
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//---------------------------------------------查询区间最大值----------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">double</span> <span style="color:#75af00">finda</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回最大值
</span><span style="color:#75715e"></span>		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树.查询左子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span><span style="color:#75715e">//从中间切开,分别查询,返回最大值
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#f92672">-</span><span style="color:#111">inf</span><span style="color:#111">;</span><span style="color:#75715e">//防止破坏
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//--------------------------------------------查询区间最小值-----------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">double</span> <span style="color:#75af00">findi</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回最小值
</span><span style="color:#75715e"></span>		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其左子树,查询左子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span><span style="color:#75715e">//从中间切开,分别查询,返回最小值
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">inf</span><span style="color:#111">;</span><span style="color:#75715e">//防止破坏
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------查询区间和------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">double</span> <span style="color:#75af00">findu</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span><span style="color:#111">;</span><span style="color:#75715e">//若区间正正好完全重合,返回区间和
</span><span style="color:#75715e"></span>		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//若待查询区间位于其左子树,查询左子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//若待查询区间位于其右子树,查询右子树
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span><span style="color:#75715e">//从中间切开,分别查询,返回和
</span><span style="color:#75715e"></span>		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">inf</span><span style="color:#111">;</span><span style="color:#75715e">//防止破坏
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//---------------------------------------------区间加法---------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_add</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间完全重合
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//若不是叶子结点,更新加法标记
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间最小值
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间最大值
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子树前先传递标记
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若区间完全位于其左子树,向左子树查找区间l~r并执行加法
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span>
				<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若区间完全位于其右子树,向右子树查找区间l~r并执行加法
</span><span style="color:#75715e"></span>				<span style="color:#00a8c8">else</span><span style="color:#75715e">//从中间切开,分别执行加法
</span><span style="color:#75715e"></span>				<span style="color:#111">{</span>
					<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
					<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
	<span style="color:#75715e">//----------------------------------------------区间乘法--------------------------------------------------
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_multiply</span><span style="color:#111">(</span><span style="color:#111">node</span> <span style="color:#f92672">*</span><span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间完全重合
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//若不是叶子结点,更新乘法标记
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">k</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span><span style="color:#75715e">//若乘数为正
</span><span style="color:#75715e"></span>			<span style="color:#111">{</span>
				<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最大的还是最大的
</span><span style="color:#75715e"></span>				<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最小的还是最小的
</span><span style="color:#75715e"></span>			<span style="color:#111">}</span>
			<span style="color:#00a8c8">else</span>
			<span style="color:#111">{</span>
				<span style="color:#00a8c8">double</span> <span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span><span style="color:#111">;</span><span style="color:#75715e">//暂时储存
</span><span style="color:#75715e"></span>				<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最大的符号相反后变成最小的
</span><span style="color:#75715e"></span>				<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//原来最小的符号相反后变为最大的
</span><span style="color:#75715e"></span>			<span style="color:#111">}</span>
			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新区间和
</span><span style="color:#75715e"></span>			<span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span><span style="color:#75715e">//更新加法标记(下面每个数要加的数也乘了k)
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#75715e">//若区间被完全包含
</span><span style="color:#75715e"></span>		<span style="color:#111">{</span>
			<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//使用子节点前先更新标记
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若待操作区间完全位于左子树,向左子树查询并进行区间乘法
</span><span style="color:#75715e"></span>			<span style="color:#00a8c8">else</span>
				<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span><span style="color:#75715e">//若待操作区间完全位于右子树,向右子树查询并进行区间乘法
</span><span style="color:#75715e"></span>				<span style="color:#00a8c8">else</span><span style="color:#75715e">//从中间切开,分别进行操作
</span><span style="color:#75715e"></span>				<span style="color:#111">{</span>
					<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">left</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
					<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">right</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#f92672">-&gt;</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span><span style="color:#75715e">//更新
</span><span style="color:#75715e"></span>	<span style="color:#111">}</span>
<span style="color:#111">};</span>
<span style="color:#111">tree</span> <span style="color:#111">Te</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">()</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">char</span> <span style="color:#111">D</span><span style="color:#111">;</span>
<span style="color:#111">aaa</span><span style="color:#111">:</span><span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">D</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">switch</span> <span style="color:#111">(</span><span style="color:#111">D</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;B&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//构造
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">n</span><span style="color:#111">;</span>
		<span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span> <span style="color:#111">muns</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">num</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">n</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">num</span><span style="color:#111">;</span>
			<span style="color:#111">muns</span><span style="color:#111">.</span><span style="color:#111">push_back</span><span style="color:#111">(</span><span style="color:#111">num</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#111">muns</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;N&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//查询区间最小值
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;min&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;M&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//查询区间和
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;sum&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;X&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//查询区间最大值
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;max&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;J&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//区间加法
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">add</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;C&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//区间乘法
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">multiply</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;O&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//输出
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">out</span><span style="color:#111">();</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;E&#39;</span><span style="color:#f92672">:</span><span style="color:#75715e">//结束
</span><span style="color:#75715e"></span>	<span style="color:#111">{</span>
		<span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">goto</span> <span style="color:#111">aaa</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="数组版知道能拿数组写就好">数组版(知道能拿数组写就好)</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;algorithm&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#00a8c8">using</span> <span style="color:#00a8c8">namespace</span> <span style="color:#111">std</span><span style="color:#111">;</span>
<span style="color:#75715e">#define inf 0x3f3f3f3f
</span><span style="color:#75715e"></span><span style="color:#00a8c8">class</span> <span style="color:#75af00">tree</span>
<span style="color:#111">{</span>
<span style="color:#00a8c8">public</span><span style="color:#f92672">:</span>
	<span style="color:#00a8c8">struct</span> <span style="color:#75af00">node</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">max</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">min</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">sum</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
		<span style="color:#111">node</span><span style="color:#111">()</span>
		<span style="color:#111">{</span>
			<span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">;</span>
			<span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">;</span>
			<span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
			<span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
			<span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
	<span style="color:#111">}</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#ae81ff">10000</span><span style="color:#111">];</span><span style="color:#75715e">//T[n*2+1]是T[n]的左子树,T[n*2+2]是T[n]的右子树
</span><span style="color:#75715e"></span>	<span style="color:#00a8c8">void</span> <span style="color:#75af00">build</span><span style="color:#111">(</span><span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span> <span style="color:#111">num</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">nums</span> <span style="color:#f92672">=</span> <span style="color:#111">num</span><span style="color:#111">;</span>
		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">nums</span><span style="color:#111">.</span><span style="color:#111">size</span><span style="color:#111">()</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">double</span> <span style="color:#75af00">find</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">string</span> <span style="color:#111">mode</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;max&#34;</span><span style="color:#111">)</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;min&#34;</span><span style="color:#111">)</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">mode</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;sum&#34;</span><span style="color:#111">)</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">add</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">multiply</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
<span style="color:#00a8c8">private</span><span style="color:#f92672">:</span>
	<span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span><span style="color:#111">nums</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span><span style="color:#111">);</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span><span style="color:#111">);</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_build</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">=</span> <span style="color:#111">l</span><span style="color:#111">;</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">=</span> <span style="color:#111">nums</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">);</span>
		<span style="color:#111">_build</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">else</span>
		<span style="color:#111">{</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
		<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">double</span> <span style="color:#75af00">finda</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span><span style="color:#111">;</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">finda</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#f92672">-</span><span style="color:#111">inf</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">double</span> <span style="color:#75af00">findi</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span><span style="color:#111">;</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">findi</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">double</span> <span style="color:#75af00">findu</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span><span style="color:#111">;</span>
		<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">return</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">findu</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">return</span> <span style="color:#111">inf</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_add</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">+=</span> <span style="color:#111">k</span> <span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">else</span>
				<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#00a8c8">else</span>
				<span style="color:#111">{</span>
					<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
					<span style="color:#111">_add</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">void</span> <span style="color:#75af00">_multiply</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span><span style="color:#111">)</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_multiply</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">k</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span>
			<span style="color:#111">{</span>
				<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
				<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">}</span>
			<span style="color:#00a8c8">else</span>
			<span style="color:#111">{</span>
				<span style="color:#00a8c8">double</span> <span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span><span style="color:#111">,</span> <span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span><span style="color:#111">;</span>
				<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">max</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span>
				<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">min</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span> <span style="color:#f92672">*</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">}</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">sum</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">lazy_add</span> <span style="color:#f92672">*=</span> <span style="color:#111">k</span><span style="color:#111">;</span>
			<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
		<span style="color:#111">}</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">mid</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">-</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">r</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
			<span style="color:#00a8c8">else</span>
				<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">l</span><span style="color:#111">)</span> <span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#00a8c8">else</span>
				<span style="color:#111">{</span>
					<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
					<span style="color:#111">_multiply</span><span style="color:#111">(</span><span style="color:#111">n</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">T</span><span style="color:#111">[</span><span style="color:#111">n</span><span style="color:#111">].</span><span style="color:#111">l</span> <span style="color:#f92672">+</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
				<span style="color:#111">}</span>
		<span style="color:#111">}</span>
		<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
<span style="color:#111">};</span>
<span style="color:#111">tree</span> <span style="color:#111">Te</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">()</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">char</span> <span style="color:#111">D</span><span style="color:#111">;</span>
<span style="color:#111">aaa</span><span style="color:#111">:</span><span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">D</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">switch</span> <span style="color:#111">(</span><span style="color:#111">D</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;B&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">n</span><span style="color:#111">;</span>
		<span style="color:#111">vector</span><span style="color:#f92672">&lt;</span><span style="color:#00a8c8">double</span><span style="color:#f92672">&gt;</span> <span style="color:#111">muns</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">num</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">n</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span>
		<span style="color:#111">{</span>
			<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">num</span><span style="color:#111">;</span>
			<span style="color:#111">muns</span><span style="color:#111">.</span><span style="color:#111">push_back</span><span style="color:#111">(</span><span style="color:#111">num</span><span style="color:#111">);</span>
		<span style="color:#111">}</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#111">muns</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;N&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;min&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;M&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;sum&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;X&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">find</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;max&#34;</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">endl</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;J&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">add</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
		<span style="color:#00a8c8">break</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">case</span> <span style="color:#d88200">&#39;C&#39;</span><span style="color:#f92672">:</span>
	<span style="color:#111">{</span>
		<span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">double</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">l</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">r</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">k</span><span style="color:#111">;</span>
		<span style="color:#111">Te</span><span style="color:#111">.</span><span style="color:#111">multiply</span><span style="color:#111">(</span><span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">k</span><span style="color:#111">);</span>
	<span style="color:#111">}</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">goto</span> <span style="color:#111">aaa</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="压行版最好多打几遍背下来">压行版(最好多打几遍背下来)</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">98
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span><span style="color:#75715e">&lt;algorithm&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#00a8c8">using</span> <span style="color:#00a8c8">namespace</span> <span style="color:#111">std</span><span style="color:#111">;</span>
<span style="color:#00a8c8">int</span> <span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//加法标记
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">lm</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//乘法标记
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//节点最大值
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//节点最小值
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//节点区间和
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//左端点
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//右端点
</span><span style="color:#75715e"></span><span style="color:#00a8c8">int</span> <span style="color:#111">num</span><span style="color:#111">[</span><span style="color:#ae81ff">100000</span><span style="color:#111">];</span><span style="color:#75715e">//临时数据
</span><span style="color:#75715e"></span><span style="color:#75715e">#define ls (p&lt;&lt;1)</span><span style="color:#75715e">//左儿子
</span><span style="color:#75715e"></span><span style="color:#75715e">#define rs (ls|1)</span><span style="color:#75715e">//右儿子
</span><span style="color:#75715e"></span><span style="color:#75715e">#define mid (ln[p]+rn[p]&gt;&gt;1)
</span><span style="color:#75715e">#define a la[p]</span><span style="color:#75715e">//当前节点加法标记
</span><span style="color:#75715e"></span><span style="color:#75715e">#define m lm[p]</span><span style="color:#75715e">//当前节点减法标记
</span><span style="color:#75715e"></span><span style="color:#00a8c8">inline</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">updata</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">],</span> <span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]);</span>
	<span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">],</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]);</span>
	<span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">];</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">build</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">l</span><span style="color:#111">;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">r</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">num</span><span style="color:#111">[</span><span style="color:#111">l</span><span style="color:#111">];</span>
		<span style="color:#00a8c8">return</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">);</span> <span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span> <span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">inline</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">down</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">m</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">lm</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span>
		<span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">lm</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">m</span><span style="color:#111">;</span>
		<span style="color:#111">lm</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">a</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">la</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">(</span><span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">-</span> <span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">ls</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">a</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">a</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">(</span><span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">-</span> <span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">rs</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">a</span><span style="color:#111">;</span>
		<span style="color:#111">a</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">change</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">add</span><span style="color:#75715e">/*加法*/</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">mut</span><span style="color:#75715e">/*乘法*/</span><span style="color:#111">)</span><span style="color:#75715e">//乘法优先
</span><span style="color:#75715e"></span><span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span>
	<span style="color:#111">{</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span>
		<span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">add</span><span style="color:#111">;</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">add</span><span style="color:#111">;</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">+=</span> <span style="color:#111">(</span><span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">-</span> <span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">add</span><span style="color:#111">;</span>
		<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">!=</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#111">{</span> <span style="color:#111">a</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span> <span style="color:#111">a</span> <span style="color:#f92672">+=</span> <span style="color:#111">add</span><span style="color:#111">;</span> <span style="color:#111">m</span> <span style="color:#f92672">*=</span> <span style="color:#111">mut</span><span style="color:#111">;</span> <span style="color:#111">}</span> <span style="color:#00a8c8">return</span><span style="color:#111">;</span>
	<span style="color:#111">}</span>
	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">add</span><span style="color:#111">,</span> <span style="color:#111">mut</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">else</span> <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">add</span><span style="color:#111">,</span> <span style="color:#111">mut</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">else</span> <span style="color:#111">{</span> <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">,</span> <span style="color:#111">add</span><span style="color:#111">,</span> <span style="color:#111">mut</span><span style="color:#111">);</span> <span style="color:#111">change</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">,</span> <span style="color:#111">add</span><span style="color:#111">,</span> <span style="color:#111">mut</span><span style="color:#111">);</span> <span style="color:#111">}</span>
	<span style="color:#111">updata</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">mx</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">x</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">];</span>
	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">mx</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">mx</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">return</span> <span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">mx</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">mx</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">mn</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">n</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">];</span>
	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">mn</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">mn</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">return</span> <span style="color:#111">min</span><span style="color:#111">(</span><span style="color:#111">mn</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">),</span> <span style="color:#111">mn</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">));</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">sum</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">p</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#00a8c8">int</span> <span style="color:#111">r</span><span style="color:#111">)</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">ln</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">l</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#111">rn</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">]</span> <span style="color:#f92672">==</span> <span style="color:#111">r</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">s</span><span style="color:#111">[</span><span style="color:#111">p</span><span style="color:#111">];</span>
	<span style="color:#111">down</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">l</span> <span style="color:#f92672">&gt;</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">r</span> <span style="color:#f92672">&lt;=</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#00a8c8">return</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">return</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">ls</span><span style="color:#111">,</span> <span style="color:#111">l</span><span style="color:#111">,</span> <span style="color:#111">mid</span><span style="color:#111">)</span> <span style="color:#f92672">+</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#111">rs</span><span style="color:#111">,</span> <span style="color:#111">mid</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">r</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">()</span>
<span style="color:#111">{</span>
	<span style="color:#00a8c8">int</span> <span style="color:#111">n</span><span style="color:#111">;</span>
	<span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">n</span><span style="color:#111">;</span>
	<span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#111">n</span><span style="color:#111">;</span> <span style="color:#111">i</span><span style="color:#f92672">++</span><span style="color:#111">)</span> <span style="color:#111">cin</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#111">num</span><span style="color:#111">[</span><span style="color:#111">i</span><span style="color:#111">];</span>
	<span style="color:#111">build</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">n</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
	<span style="color:#75715e">//change(1, 0, n - 1, 1, 2);
</span><span style="color:#75715e"></span>	<span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">sum</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span><span style="color:#111">,</span> <span style="color:#111">n</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span><span style="color:#111">);</span>
	<span style="color:#00a8c8">return</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#111">}</span>
</code></pre></td></tr></table>
</div>
</div>]]></description>
                    
                        
                    
                    
                        
                            
                        
                            
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/rmq/">RMQ</category>
                                    
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</category>
                                    
                                
                                    
                                    
                                    
                                        <category domain="http://example.com/tags/c&#43;&#43;/">c&#43;&#43;</category>
                                    
                                
                            
                        
                    
                </item>
            
        
    </channel>
</rss>